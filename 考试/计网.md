# 概述
### 计算机网络分为什么？
从组成部分看：计算机网络由<u>硬件，软件，协议</u>组成

==从工作方式：计算机网络还可以分为 ***边缘部分***【用户用的设备】 和 ***核心部分***【大量的网络，路由器】==

从功能：计算机网络分为 资源子网【相当于淘宝卖家】 和 通信子网【相当于快递】
### 功能
- 数据通信
- 资源共享
- 分布式处理【把复杂工作交给网络上的某台计算机】
- 提高可靠性【例如A计算机坏了，用B计算机】
- 负载均衡
### 性能指标
发送时延：最后一个bit发送完毕的时间 - 第一个bit发送的时间【==注意发送时延跟接收方没关系==】

传播时延：一个bit 从链路一段到另一端的时间
往返时间RTT：指的是发送方需要多少时间才知道自己发送的数据已经被接收了
往返时间RTT = 2 * 传播时延

处理时延：路由器等设备在处理数据时所花费的时间

排队时延：数据进入路由器等待处理的时间

往返时延：从发送端发送数据开始，到发送端接受到来自接收端确认所花费的时间

---
***总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延***

---
吞吐量：单位时间内通过***某个网络接口***的数据量
速率：连接到接口上的***主机上***的传输速率，最高数据率称为==带宽==

时延带宽积：发送端发送的第一个bit到达终点时，已经发送出去了多少个bit【==也就是此时此刻信道上有多少数据==】。***时延带宽积 = 传播时延  \* 信道带宽***
# 分层
==协议：是由 语法【规定传输格式】，语义【规定要完成的功能】，同步【规定各种操作的时序关系】组成的规则的集合==

接口：是相邻两层交换信息的连接点

服务：是下层为上层提供的功能
### OSI模型
![[Excalidraw/杂/草稿纸 Draw.md#^group=LR8iAK58|800]]
- 物理层：传输单位是bit，功能是透明传输比特流
- 数据链路层：传输单位是帧，将网络层传来的ip数据报组装成帧
- 网络层：传输单位是数据报，功能是网络层之间的连接和报文的转发路由,实现***主机与主机之间的逻辑通信***
- 传输层：传输单位是报文段，负责主机中***两个进程的通信***
- 会话层：会话层允许不同主机间各个进程的会话，会话层利用传输层的服务，为表示层建立连接
- 表示层：就是把二进制数据变成某些可读的形式
- 应用层：用户与网络的界面
### TCP/IP模型
![[Excalidraw/杂/草稿纸 Draw.md#^group=e3pJyKNr|700]]

- ***传输层*** 定义端到端，窗口大小可以动态变化
- ***数据链路层*** 定义两个中间相邻结点，窗口大小固定【发送方在发送帧之前必须等待接收方的确认信息】

>[!hint] OSI 与 TCP/IP 的区别
>- TCP/IP在服务，协议，接口上没有明确的区分
>- OSI在网络层有面向连接和无连接，在传输层只有面向连接
>- TCP/IP在网际层只有无连接，但在传输层支持无连接和面向连接
# 物理层
### 通信基础
信号：数据的电磁表现

码元：用固定时长的信号波形表示一位k进制的数字

信源：产生数据的源头

信宿：接受数据的终点

信道：信号传输的媒介

###### 单工通道
>只有一个方向的通信，只能 A-->B 或者 B-->A
###### 半双工通道
>每个通道都允许数据在两个方向上传输，但是每个通道在同一时刻只能进行单向传输
###### 全双工通道
>通信的两个节点可以同时发送和接收数据，而不需要等待对方完成传输
### 🌗nice定理 
$$
理想低通信道下的极限数据传输速率 = 2Wlog₂V
$$
W ：信道带宽
2W：码元传输的最高速率
V：每个码元离散电平的数目

***在任何信道，码元传输速率都是有上限的，如果超过此上限，就会出现码元扰乱问题，接收端就不能正确接收识别***
### 🌗香农公式
$$
信道的极限数据传输速率 = Wlog₂(1+\frac{S}{N})
$$
W：带宽
S/N：信噪比

***对一定的传输带宽，和一定的信噪比，信息传输速率的上限是确定的***
### 编码与调制
编码：数据变换为数字信号的过程

调制：数据变换为模拟信号的过程




### 🌗电路交换，报文，分组交换



##### 🌑数据报，虚电路


### 传输介质，物理层设备


### 接口特性
# 数据链路层
### 功能
- 向网络层提供服务
	- 无确认的无连接服务：发送数据帧时不需要建立连接，目的机器收到数据时也不需要发回确认
	- 有确认的无连接服务：发送数据帧时不需要建立连接，目的机器收到数据时需要发回确认
	- 有确认的有连接服务：发送数据帧时需要建立连接，目的机器收到数据时需要发回确认
- 透明传输
- 流量控制
- 差错控制
### 组帧
##### 字符计数法
>在每一帧的起始位置定义帧内字符数
>![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231222162822.png)

>[!attention] 如果帧内第一个字符数在传输时出现差错，那么将是灾难性的
##### 字符填充的首尾定界符法
>![[Excalidraw/杂/草稿纸 Draw.md#^group=u14NPzG8|700]]
##### 🌑零比特填充的首尾标志法
>每当遇到5的1就填充一个0
>![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231222165154.png)
### 差错控制
##### 奇偶校验码
```
001001  // 原本要传输的数据
1001001  // 在开头加上0/1之后，要保证总数1为奇数

001001  // 原本要传输的数据
001001  // 在开头加上0/1之后，要保证总数1为偶数
```
##### 🌑循环冗余码
![[Excalidraw/杂/草稿纸 Draw.md#^group=HI66uiPp|780]]
### 🌗流量控制与可靠传输机制
##### 滑动窗口机制
-  停止---等待
>发送方每发送一帧，都要等待接受方的应答，才能发送下一帧。接收方接受到数据后，都要返回应答信号

- 后退n帧
>连续发送多个帧，如果有帧出错了，那就从出错的那一帧开始丢弃，再重新发
>![[Excalidraw/杂/草稿纸 Draw.md#^group=yeKB6Zqq|670]]
>

- 选择重传
>不会丢弃出错的帧的后续的帧
>![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231222191031.png)
>此处要满足***接收窗口数 + 发送窗口数 ≤ 序列号数【16】***
### 🌗介质访问控制
- 频分多路复用
>一条大道分成两条小道

- 时分多路复用
>比如1-2点给A用，2-4点给B用

- 波分多路复用
>A 和 B 用不同的波长给C传输数据

- 码分多路复用
>在传输之前，混合A 和 B ，然后在目的地C解析
>![[Excalidraw/杂/草稿纸 Draw.md#^group=CEnog6GP|790]]


##### 纯aloha协议
>***不进行检测***就发送数据，如果在一段时间内未被确认，就会重新发送数据

可能发生数据冲突
##### 时隙aloha协议
>在每个规定的间隙的开始发送数据，减少数据冲突的可能
##### CSMA协议
>发送数据时，首先监听信道
>![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231222213854.png)
##### 🌑CSMA/CD协议
>先听后发，边听边发，冲突停发，随机重发
>应用于***有线网***

>[!hint] 在A发送数据给B时，可能会发生碰撞，那么我们要等多久才知道，碰撞没有发生呢？
>当信号发生碰撞时，碰撞的信号会返回回去。
>那这个时间什么时候是最久的呢？
>当A的信号快要到达B时，B发出了信号，然后产生了碰撞，然后碰撞信号再传回去给A，这段过程经过的时间就是***2Π***
>所以只要时间超过了2Π，我们就认为没有发生碰撞

>[!attention] 以太网规定2Π=51.2μs

>[!hint] 规定最小帧长
>因为发送端要在发送数据的期间发现自己发送的数据的问题，也就是说，要在2Π结束时，保证发送端的数据还没发完

>[!hint] 退避算法
>由于发生碰撞之后，紧接着再发送还是会碰撞，没有意义，所以要规定退避算法
>- 基本退避时间 = 2Π
>- k = 重传次数，k ≤ 10
>- 建立一个集合【0，……，2<sup>k</sup>-1】，中随机取出一个数r
>- 那么重传的退避时间就是***2rΠ***
>
>==如果重传16次都不能成功，说明无法到达==

>[!attention] 全双工模式不会发生冲突，所以不会使用CSMA/CD协议
##### 🌑令牌传递协议
>比如A，B，C要发送数据，那么会有一个中间节点集中控制，轮询A，B，C谁要发送数据，然后把信道交由它控制
### 🌗局域网
##### 概念
>局域网主要是星型结构，环形结构，总线型结构，星型和总线型结合结构，以双绞线为主流传输介质，用到的介质控制方法有CSMA/CD，令牌总线，令牌环

##### 以太网
>采用总线型拓扑结构，信息以广播形式发送

- 采用无连接的工作方式，提供的是不可靠服务
- 发送的数据使用曼彻斯特编码
- 每块网卡都有唯一的代码，叫介质访问控制地址【MAC】

![[Excalidraw/杂/草稿纸 Draw.md#^group=WBdGcCri|780]]
### 🌗广域网
>广域网由一些结点交换机及链路组成，覆盖范围比局域网广，远超一个城市范围

>[!hint] 局域网之间是由广域网连接的

![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231223104748.png)
##### ppp协议
- ppp协议需要建立连接
- 支持多种网络层协议
- 传输长度收到MTU限制

![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231223114724.png)

>[!hint] 面向字节的，所以使用的是字节填充法

>[!hint] 不可靠传输，差错检测由高层协议负责
##### HDLC协议
主站 通过发出命令帧来控制 从站，从站 就会发出响应帧来回应 主站。而复合站同时具有主站，从站的功能

- 正常响应方式【主站--从站】
- 异步平衡方式【复合--复合】
- 异步响应方式【从站未受到主站的命令，也可以发送数据】

>[!hint] HDLC是面向比特的

>[!hint] HDLC使用可靠传输
### 设备
##### 网桥
>网桥用于连接以太网，工作在链路层，一个以太网称为一个网段【一个碰撞域】

- 网桥接收数据的协议，与发送数据的协议可能不同
- 网桥有寻址的能力

###### 透明网桥
- 原局域网和目的地局域网相同，则丢弃帧
- 原局域网和目的地局域网不同，则转发帧【以***广播***的形式】

![[Excalidraw/杂/草稿纸 Draw.md#^group=TykEQax6|780]]
###### 源路由网桥
1. A要发数据给B
2. A发送找B的发现帧
3. 可能有多条路径的发现帧到达B
4. B再一一发送应答帧原路返回
5. 第一个到达A的应答帧就是最佳路径
6. 然后A在沿着这条路径发送数据
##### 以太网交换机
以太网交换机是一个多端口的网桥，有两种交换模式【直通式，存储转发式】

>[!hint] 找到端口就转发给它，不会广播到所有设备
###### 直通式
直通式交换机只检查帧的目的地址就转发
- 速度快
- 不安全
###### 存储转发式
收到帧先存起来，如果帧有错就丢弃
- 可靠性高
- 延迟大
- 端口支持不同速率
# 网络层
### 功能
- 异构网络互联【在互联网里大大小小的网络集合起来同一视作一个大型的虚拟网络】
- 路由与转发【路由器的路由选择（选择路径），分组转发（报文）】
- 拥塞控制
### 路由算法
##### 静态路由
>有管理员来手动配置路由信息，适合小型网络
##### 动态路由
>路由表之间相互交换信息，会不断更新变化
###### 距离-向量路由算法
>所有结点会定期将它们的路由表传送给 ***所有相邻的结点***

- 在有路由器加入时，更新路由表
- 发现有更短路径时，优先选择
###### 链路状态路由算法
>每个结点都具有整个网络的拓扑信息

- 结点会主动测试所有邻接结点的状态
- 定期将链路状态传给所有结点
###### 层次路由
![[Excalidraw/杂/草稿纸 Draw.md#^group=HhhCJtUzCOBCVJ-31cuoc|700]]
### 🌗IPv4
![[Excalidraw/杂/草稿纸 Draw.md#^group=wr24HCmG|900]]

==在以太网中，分片后的IP数据报最大为MTU【1500B】==

![[Excalidraw/杂/草稿纸 Draw.md#^group=jUFl1KnO|780]]
##### 转发分组的流程
1. 从数据报中提取IP地址，得出网络地址
2. 如果网络地址与路由器直接相连，则直接转发给目的主机
3. 如果路由器中有到达网络地址的路由信息，则传给下一个路由
4. 如果路由器中没有相应的路由信息，则发送给默认路由
5. 如果没有默认路由，则报错

![[Excalidraw/杂/草稿纸 Draw.md#^group=y8cHqzxl|800]]
##### 网络地址转换 NAT
>将私有地址 转为 公用地址

私有地址：
![image.png](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/20231224120443.png)
##### 子网划分
![[Excalidraw/杂/草稿纸 Draw.md#^group=7zvJu5d2|760]]
##### ARP协议
>通过ip地址找到mac地址
##### DHCP协议
>给主机分配动态的IP地址

1. 主机想要一个IP地址
2. 主机广播DHCP发现消息，试图找到DHCP服务器
3. DHCP服务器收到消息，向网络中广播DHCP提供消息
4. 主机收到DHCP提供消息，再广播请求消息，向服务器请求IP地址
5. 服务器广播确认消息，将IP地址分配给主机
##### ICMP协议
>用于路由器向源主机报告异常情况

- 对ICMP差错报文不发送ICMP差错报文
- 如果第一个分片发送了ICMP差错报文，那么后续分片不再发送
- 对组播地址不发送ICMP差错报文
### IPv6
>有128位

- IPv6可以自动配置IP地址
- IPv6的包只有在源结点可以分片，在传输路径中的路由器不可以分片
- 首部长度为8B的整数倍
##### RIP协议
>***相邻***的路由器会每隔***30s***更新一次***所有信息***，而且每个路由器会维护跳数。RIP认为好的路由就是跳数少的路径，RIP允许最多15跳
>![[Excalidraw/杂/草稿纸 Draw.md#^group=bbLZiYY7N7qQFEUXOaBPY|600]]

###### 距离向量算法
![[Excalidraw/杂/草稿纸 Draw.md#^group=8eZgEyGj|780]]

>[!attention] 当网络出现故障时，要很长时间才能将此信息传送到所有路由器坏消息传的慢
##### OSPF协议
>向所有路由器转发自己的相邻路由器的信息【==与RIP刚好相反==】，只有发生变化时才更新，==更新速度快==
##### BGP协议
>不同网络的路由器之间交换路由信息的协议，路由表包含路由器能够到达的地址及每个路由器路径的跳数

- 使用路径向量路由选择协议【寻找比较好的路由路径，而非最佳的】

>[!hint] RIP是应用层协议，在传输层使用的是UDP。OSPF是网络层协议。应用层协议，基于TCP
### IP组播
>使用了IGMP协议
>![[Excalidraw/杂/草稿纸 Draw.md#^group=WqnRcXUl|790]]

- 使用D类地址【前八位为11100000-11101111】
- 分为局域网上的硬件组播，因特网内的范围组播
- 当某台主机需要加入组播组时，需要向组播组的地址发送一个IGMP报文
- 组播的组成员关系是动态的【本地组播路由器会定期询问该组是否还活跃，如果不活跃就不会再将该组的成员信息转发给其他路由器】

![[Excalidraw/杂/草稿纸 Draw.md#^group=0vUqAk8V|690]]
以太网的组播地址范围：01-00-5E-00-00-00到01-00-5E-7F-FF-FF
### 移动IP
- 移动结点：有永久IP地址的结点
- 本地代理：一个移动结点的永久居所
- 外部代理：在外部网络中，帮助移动结点完成移动管理功能的实体

![[Excalidraw/杂/草稿纸 Draw.md#^group=cA5Y8KFLHdT_5k3dqWc2K|700]]

- 路由器：转发，分组，查询路由表
# 传输层
>传输层是面向通信的最高层，也是用户功能中的最低层

>[!hint] 传输层提供进程之间的逻辑通信【***端到端***】，网络层提供主机之间的逻辑通信【***点到点***】

>[!hint] 传输层在网络层不可靠的情况下，为应用层提供了可靠的服务

- 复用：发送方不同的应用进程使用同一个传输层协议
- 分用：接收方的传输层在剥去报文首部后，能够把数据交付到正确的进程中去

- 传输层对报文进行差错检测
- 提供了TCP，UDP协议

### 端口，套接字
>[!hint] IP地址是标识主机的，端口是标识进程的
>![[Excalidraw/杂/草稿纸 Draw.md#^group=u3kCGA16|700]]

套接字 = 端口号 + IP地址
### UDP
>UDP服务在IP的基础上只加了<u>复用分用</u>，<u>差错检测</u>，所以应用程序几乎是与IP打交道的

- 无需建立连接【无连接时延，无需维护连接状态】
- 首部开销小【***TCP需要20B，而UDP只需要8B***】
- 支持 n对n通信 【TCP只支持1对1】

>[!hint] UDP在计算校验和时，会加入一个 12B 的伪首部，计算完成后会删除

![[Excalidraw/杂/草稿纸 Draw.md#^group=lyynRLGNh9na4q6DUu6ts|700]]





### 🌗TCP
>解决有序，可靠，无丢失，不重复问题。使用***全双工通信***，是***面向字节流的***

- TCP报文段默认首部为20B【4B的整数倍】

![[Excalidraw/杂/草稿纸 Draw.md#^group=YqcCiHFo|990]]

主动连接的一端为客户，被动的为服务器

- 连接的建立【==三次握手==】
	- 客户机向服务器发送请求连接的报文段【SYN=1，seq=x，不能携带数据，但要消耗一个序号】
	- 服务器收到后，分配缓存和变量，再向客户机发送确认的报文段【SYN=1，ACK=1，seq=y，ack=x+1，不能携带数据，但要消耗一个序号】
	- 客户机收到后，分配缓存和变量，并再回复一个确认报文段【ACK=1，seq=x+1，ack=y+1，可以携带数据，不携带不消耗】
- 传输数据
- 连接的释放【==四次挥手==】
	- 客户机发送终止报文段【FIN=1，seq=u，如果不携带数据会消耗一个序号】
	- 服务器收到后，发送确认报文段【ACK=1，seq=v，ack=u+1】【==此时客户机已经不能发送信息给服务器了==】
	- 服务器发送终止报文段【FIN=1，ACK=1，seq=w，ack=u+1】
	- 客户机收到后，再回应确认报文段【ACK=1，seq=u+1，ack=w+1】【==服务器完全关闭连接==】【客户机等待==2MSL==后关闭连接（防止报文未正确到达服务器）】

![[Excalidraw/杂/草稿纸 Draw.md#^group=WVXmNZN5|700]]![[Excalidraw/杂/草稿纸 Draw.md#^group=FaXiIuKH|700]]
>[!hint] TCP的可靠连接是由 序号seq，确认ack，重传【在超时和冗余ack时】

>[!hint] 拥塞控制 与 流量控制
>拥塞控制是防止过多的数据注入网络【涉及所有主机，路由器】
>流量控制只是点到点【抑制发送端的发送速率】


$$
吞吐量=\frac{窗口大小}{RTT(往返时间)}
$$
##### 拥塞控制
- 慢开始【加倍】

![[Excalidraw/杂/草稿纸 Draw.md#^group=77RNzCeS|690]]
- 拥塞避免【加1】

每经过一个往返时间RTT，就cwnd+1，慢开始门限跟着算法一起增长

![[Excalidraw/杂/草稿纸 Draw.md#^group=yLb6dvEg|790]]
##### 快重传，快恢复
>当连续收到三个重复的ACK报文后，直接重传。并且把门限减半，继续拥塞避免算法
>![[Excalidraw/杂/草稿纸 Draw.md#^group=loVstxtF|700]]
# 应用层
### 网络应用模型
- 客户/服务器

![[Excalidraw/杂/草稿纸 Draw.md#^group=u9Kb4FMs]]

- P2P

将内容不再保存到中心服务器上，每个结点的权利和义务大致相同
### 🌗域名系统
##### 层次域名空间
![[Excalidraw/杂/草稿纸 Draw.md#^group=oGVzGDtB]]
- 级别最高的域名在最右边
##### 域名服务器
>可以根据域名查找IP地址【使用UDP】。分为根域名，顶级域名，权限域名，本地域名服务器

![[Excalidraw/杂/草稿纸 Draw.md#^group=ROXtyMcd|790]]
### FTP
>提供交互式访问【允许用户指明文件类型和格式】，采用***客户/服务器***的工作方式，使用***TCP***

- 开启21端口，等待客户进程连接
- 从属进程处理客户发来的请求，主从进程并发执行
- 从属进程终止
- 回到等待状态，继续接收其他客户进程的请求

服务器有被动模式可以让客户端通过20端口发送数据给服务端
### 电子邮件
- 用户代理【例如qq邮箱】
- 邮件服务器【邮件存的地方】
- 协议
	- SMTP
	- POP3
		- 端口号：110

![[Excalidraw/杂/草稿纸 Draw.md#^group=DG2d5cqf|900]]
MIME协议解决了发送时的格式问题

##### 邮件的格式
![[Excalidraw/杂/草稿纸 Draw.md#^group=k2yQbEWz]]
### 万维网www
`http://i.chaoxing.com/base?t=1646397571813`  com/后的东西称为***统一资源定位符url***，使用超文本传输协议发送给使用者

万维网内核：url，http，html

---

- Web浏览器指定url与服务器建立连接，发送请求
- 服务器把url转换为文件路径，返回消息给浏览器

---

非持久连接：页面上的每个元素的传输都需要建立一次TCP连接
持久连接：页面上的所有元素会连续传输，TCP连接会一直保持



---
习题
- 二
- 5.16










