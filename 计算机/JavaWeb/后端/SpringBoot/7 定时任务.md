# 静态任务
> 静态任务是在应用启动时就被加载和注册的定时任务，调度时间在应用启动时就被计算。它们是基于配置文件或代码中的 `@Scheduled` 注解声明的

```java
@Scheduled(cron="0 0 2 * * ?") //每天凌晨2点执行
public void doStaticTask() {
    // 执行静态定时任务的代码
}
```

## 操作步骤
- 在类上加入 `@EnableScheduling`，<u>开启定时任务</u>
```java
@Configuration
@EnableScheduling
public class ChatBotSchedule {……}
```

- 使用 `@Scheduled`，对任务<u>设置执行时间</u>。有三种配置执行时间的方式：
	- `cron 表达式` 
	- `fixedRate` 自上一次执行开始之后多长时间执行【以毫秒为单位】
	- `fixedRateString` 与 `fixedRate` 相同，但是<u>支持占位符</u>
	- `fixedDelay` 自上一次执行结束之后多长时间执行【单位是毫秒】
	- `fixedDelayString`
	- `initialDelay` 首次执行要延迟多长时间【单位毫秒】，其他执行计划，按照其他注解执行
	- `initialDelayString`

```java
@Scheduled(cron = "0/20 * * * * ?")  

@Scheduled(fixedRate = 1 * 60 * 1000)  

// 配置文件中
interval=2000
@Scheduled(fixedRateStirng="${interval}")
public void RunSchedule() {……}
```

>[!hint] 一般使用功能丰富的 `cron 表达式`

## Cron 表达式
`cron= "秒 分 时 日 月 周几"`

- 取值
	- `秒` 0-59
	- `分` 0-59
	- `时` 0-23
	- `日` 1-31
	- `月` 1-12
	- `周` 1-7【1 表示 周日，7 表示周六】
- 通配符
	- 日
		- `W` 只允许在日上，表示举例最近的该日的工作日，（工作日 周一~周五）
	- 周
		- `#` 表示每月的第几个周几【比如 `1#2`，表示每月的第2个周日】【只用在周上】
	- `*` 所有值，表示每秒，每月，每日
	- `?` 不指定值【比如已经设置了每日，那具体周几就不用设置了，那么就设为 `?` 】
	- `-` 表示区间【比如在周上设置 `3-5`，就表示周三到周五都会执行】
	- `,` 多个并列，日的2，13，14，就是2号，13日，14号，都会执行
	- `/` 表示“每” 秒的2/3，从2秒开始，每三秒触发一次执行
	- `L` 只允许用在周或者日上，表示最后，表示每月的最后一个什么，例如：日上 3L 表示这个月的倒数第三天，周上 3L 表示该月最后一个周四 L表示last最后的意思，7表示周六，（6表示周五，类推，1表示周日）





# 动态任务
> 动态任务是在运行时动态添加和移除的定时任务【不需要重新启动应用】，只用通过注入 `TaskScheduler 接口的对象`，调用它的 `schedule 方法` 就可以动态创建和注册新的定时任务

```java
@Component
public class DynamicTaskScheduler {

    @Autowired
    private TaskScheduler scheduler;
    
    public void startDynamicTask() {
        scheduler.schedule(new Runnable() {
            @Override
            public void run() {
                // 执行动态定时任务的代码
            }
        }, new CronTrigger("0 0 3 * * ?"));
    }
}
```













