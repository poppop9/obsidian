# ğŸŒ•å‡†å¤‡å·¥ä½œ
- å¼•å…¥ä¾èµ–
```xml
<dependency>
     <groupId>com.qcloud</groupId>
     <artifactId>cos_api</artifactId>
     <version>5.6.155</version>
</dependency>
```
# ğŸŒ•å¯¹è±¡æ“ä½œ
### ğŸŒ—ä¸Šä¼ å¯¹è±¡
##### ğŸŒ‘æœ¬åœ°æ–‡ä»¶->äº‘
```java
public class Demo {
    public static void main(String[] args) {
        // è°ƒç”¨ COS æ¥å£ä¹‹å‰å¿…é¡»ä¿è¯æœ¬è¿›ç¨‹å­˜åœ¨ä¸€ä¸ª COSClient å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»º
        COSClient cosClient = createCOSClient();

        // å­˜å‚¨æ¡¶çš„å‘½åæ ¼å¼ä¸º BucketName-APPIDï¼Œæ­¤å¤„å¡«å†™çš„å­˜å‚¨æ¡¶åç§°å¿…é¡»ä¸ºæ­¤æ ¼å¼
        String bucketName = "test-1307744200";
        // å¯¹è±¡é”®(Key)æ˜¯å¯¹è±¡åœ¨å­˜å‚¨æ¡¶çš„åç§°
        String key = "/exampleobject.png";
        // æœ¬åœ°æ–‡ä»¶è·¯å¾„
        String localFilePath = "E:/å›¾ç‰‡/2023-11-29_134222.png";
        File localFile = new File(localFilePath);

        PutObjectRequest putObjectRequest = new PutObjectRequest(bucketName, key, localFile);

        try {
            PutObjectResult putObjectResult = cosClient.putObject(putObjectRequest);
            System.out.println(putObjectResult.getRequestId());
        } catch (CosClientException e) {
            e.printStackTrace();
        }

        // ç¡®è®¤æœ¬è¿›ç¨‹ä¸å†ä½¿ç”¨ cosClient å®ä¾‹ä¹‹åï¼Œå…³é—­å³å¯
        cosClient.shutdown();
    }

    static COSClient createCOSClient() {
        String secretId = "AKIDtlYAZjgQwiMmzxhDi7RbefnkT4Siz8Zz";
        String secretKey = "IOQKLDtOirptnjbN0Tkooqy66wcBlDTh";
        COSCredentials cred = new BasicCOSCredentials(secretId, secretKey);

        // ClientConfig ä¸­åŒ…å«äº†åç»­è¯·æ±‚ COS çš„å®¢æˆ·ç«¯è®¾ç½®ï¼š
        ClientConfig clientConfig = new ClientConfig();

        // è®¾ç½® bucket çš„åœ°åŸŸ,å…·ä½“è¯·å‚è§ https://cloud.tencent.com/document/product/436/6224
        clientConfig.setRegion(new Region("ap-shanghai"));

        // è®¾ç½®è¯·æ±‚åè®®, http æˆ–è€… https
        clientConfig.setHttpProtocol(HttpProtocol.https);

        // ç”Ÿæˆ cos å®¢æˆ·ç«¯
        return new COSClient(cred, clientConfig);
    }
}

---
NjU2NmU3MmRfOWJhNTEyMDlfY2M1ZV80ZTk3NTAz
---
å›¾åƒurlï¼šhttps://test-1307744200.cos.ap-shanghai.myqcloud.com/exampleobject.png
```
##### ğŸŒ‘å‰ç«¯çš„å›¾ç‰‡->äº‘
![[Excalidraw/è®¡ç®—æœº/JavaWeb Draw.md#^group=NJQez6fp|600]]
```java
package com.example.controller;

@RestController
public class UploadController {
    @Autowired
    private TencentCOS tCOS;

    //å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶åˆ°è…¾è®¯äº‘ï¼Œå†è¿”å›æ–‡ä»¶çš„urlç»™å‰ç«¯
    @PostMapping("/upload")
    public Result UploadFile(MultipartFile file) throws IOException {
        String url = tCOS.upload(file);
        return Result.buildResult(Result.Status.OK, url);
    }
}

---
NjU2NmYzOTdfODVjZjExMGJfMWU2MTJfMTBlMjU5YWM=
```

```java
package com.example.utils;

//è¿™æ˜¯ä¸€ä¸ªæŠŠæ–‡ä»¶ä¸Šä¼ åˆ°è…¾è®¯äº‘çš„å·¥å…·ç±»

@Component  //å°†è¯¥ç±»äº¤ç»™IOCå®¹å™¨ç®¡ç†
public class TencentCOS {
    public String upload(MultipartFile file) throws IOException {
        //åˆ›å»ºcosClientå¯¹è±¡
        COSClient cosClient = createCOSClient();

        String bucketName = "test-1307744200";
        // å¯¹è±¡é”®(Key)æ˜¯å¯¹è±¡åœ¨å­˜å‚¨æ¡¶çš„åç§°
        String originalFilename = file.getOriginalFilename();
        int indexOf = originalFilename.lastIndexOf(".");
        String suffixName = originalFilename.substring(indexOf);
        String uuid = UUID.randomUUID().toString();
        String key = "/" + uuid + suffixName;

        // è·å–æ–‡ä»¶è¾“å…¥æµ
        InputStream inputStream = file.getInputStream();
        ObjectMetadata objectMetadata = new ObjectMetadata();

        PutObjectRequest putObjectRequest = new PutObjectRequest(bucketName, key, inputStream, objectMetadata);

        try {
            PutObjectResult putObjectResult = cosClient.putObject(putObjectRequest);
            System.out.println(putObjectResult.getRequestId());
        } catch (CosClientException e) {
            e.printStackTrace();
        }

        // ç¡®è®¤æœ¬è¿›ç¨‹ä¸å†ä½¿ç”¨ cosClient å®ä¾‹ä¹‹åï¼Œå…³é—­å³å¯
        cosClient.shutdown();

        String url = "https://" + bucketName + ".cos.ap-shanghai.myqcloud.com" + key;
        return url;
    }

	//è¿”å›å€¼ä¸ºCOSClientçš„createCOSClientæ–¹æ³•
    COSClient createCOSClient() {
        String secretId = "AKIDtlYAZjgQwiMmzxhDi7RbefnkT4Siz8Zz";
        String secretKey = "IOQKLDtOirptnjbN0Tkooqy66wcBlDTh";
        COSCredentials cred = new BasicCOSCredentials(secretId, secretKey);

        ClientConfig clientConfig = new ClientConfig();

        clientConfig.setRegion(new Region("ap-shanghai"));

        clientConfig.setHttpProtocol(HttpProtocol.https);

        return new COSClient(cred, clientConfig);
    }
}
```

























