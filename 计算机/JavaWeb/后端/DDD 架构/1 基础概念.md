# 概述
$$
DDD 就是领域驱动设计，Domain，Driven，Design
$$

## 对比 MVC ，DDD
### 架构易拆分
- 传统的 MVC 架构**架构不灵活**：在项目推进的过程中，拆分功能会拆不动【A 功能，B 功能底层的调用会很混乱，会调到一起】
![](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202403282043607.png)
- DDD 架构拆分项目会很容易
![400](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202403282101681.png)

### 业务优先
- MVC 架构的项目结构，一看是不知道这一块是干嘛的
- DDD 架构是按业务划分的
	- `genService` 
		- ……
	- `hisRequest` 
		- ……
	- `sysManage` 
		- ……

# 设计原则
- **单一职责原则**：一个类只做一件事【比如 A 类负责转账业务，那么只有转账业务流程发生变化了，才改动这个类，其他不管怎么变，A 类雷打不动】
- **开放封闭原则**：对扩展开放，对修改封闭【未来增加功能时，做到增加类，而不修改类】
- **依赖反转原则**：程序之间只依赖于抽象接口，而不依赖于具体的实现

## 充血模型
>[!hint] 贫血模型
>贫血模型就是 MVC 中的 pojo 类，里面只有属性，和 `get()`，`set()`方法
> 
> ```java
> public class Account {
> 	private int id;
> 	private int balance;  // 余额
> 
> 	……对应的 get ，set 方法
> }
> ```
> 当我们的业务多起来之后，这个 pojo 承载了哪些业务看不出来了，我需要到一个个 `Service` 中去找

---

<u>充血模型</u>就是把 pojo 的属性，以及引起属性的值发生变化的方法，写到 pojo 中。例如下面这个 pojo ，一看就知道有两个业务：

```java
public class Account {
	private int id;
	private int balance;  // 余额

	……对应的 get ，set 方法

	public void TransferIn(int money){
		balance = balance + money;
	}

	public void TransferOut(int money){
		if(balance < money){
			throws new InsufficientMonryException();
		}
		balance = balance - money;
	}
}
```

>[!warning] 只有引起 pojo 属性值变化的方法，才写到 pojo 里。【比如写入到数据库的这个操作，不会引起账户余额的变化，那就不应该写进 pojo 里】

## 仓库
>仓库 是用来管理实体类的，类似 MVC 中的 `Mapper`

>[!quote] 工厂
>>工厂 是仓库的一个组件，用来<u>组建复杂的 pojo 类</u>
>
>**好处**：<u>业务实体 和 数据库表结构 不用绑定</u>【比如 Account 类需要很多属性，来自于很多个数据库表，但是我不想 Account 类里有很多属性，那我们就可以利用 accountBuilder 构建一个新的 AccountDo，A 表里查的数据放到 AccountDo 里，B 表里查的数据也放到 AccountDo 里】

```java
// 仓库接口
public interface AccountRepository {……}

// 仓库的实现类
public class AccountRepositoryImpl {
	// 关于 Account 类的数据库操作……
	@Override
	public Account Save(Account account) {
		// 将 Account 类封装成一个更复杂的 AccountDo，这就是一个工厂
		AccountDo accountDo = accountBuilder.fromAccount(account);
		// 数据库操作……
	}
	……
}
```




# 项目结构
![450](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202403282149177.png)

- `interfaces` **接口层**，包含了与外部系统或用户的交互接口。这里的示例包括Web界面和API接口 ==Controller==
- `application` **应用层** ==Service==
- `domain` **领域层** ==Service==
	- `model` **领域模型**，定义了领域对象、聚合和值对象
		- `po` 持久化对象，通常用于表示数据库中的数据表，po 对象的属性对应数据库表的字段
		- `vo` 值对象，通常用于表示业务层传输的数据对象，vo 对象的属性包含了业务逻辑中需要的数据
		- `req` 请求对象的封装
		- `res` 响应对象的封装
	- `service` **领域服务**，包含业务逻辑，<u>但是只构建业务场景，不负责处理数据，处理数据在充血模型中处理</u>
- `infrastructure` **基础层**，包含了数据库，缓存，网关，第三方工具…… ==Mapper==





---
- **领域（Domain）**：指的是软件要解决问题的业务领域
- **子领域（Subdomain）**：一个大的领域内部的小的领域，反映了业务内部的不同分区
- **边界上下文（Bounded Context）**：明确的边界，用来定义领域模型适用的范围，它内部有一套完整的模型和统一的语言
- **领域模型（Domain Model）**：是核心概念和业务规则的抽象表示，通常通过代码（实体、值对象、聚合根等）来实现

>[!quote] 值对象
>值对象 就是 MVC 架构中的 pojo，而充血模型 = 原来 MVC 架构中的 pojo + 影响 pojo 中属性值变化的方法
>- 值对象是不可变的，一旦创建后不能修改其属性值





















