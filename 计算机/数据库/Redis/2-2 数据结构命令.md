>[!quote] Redis 支持的数据结构
>- 基本数据类型
> 	- `字符串 String`【**默认**】：可存储 512 MB
> 	- `列表 List`：字符串有序列表，<u>按照插入顺序排序</u>【可以把元素添加到列表的头部，或者尾部。可存储 40 多亿元素
> 	- `集合 Set`：字符串无序列表，集合中不允许有重复值，通过哈希表实现
> 	- `有序集合 ZSet`：字符串集合，且不允许重复的成员，每个元素都会关联一个 double 类型的分数，分数可以重复，redis 可以通过分数来为集合中的成员进行<u>从小到大</u>的排序
> 	- `哈希 Hash`：可存储 40 多亿个键值对，**适合存储对象**
> - 高级数据类型
> 	- 消息队列 Stream
> 	- 地理空间 Geospatial
> 	- HyperLogLog
> 	- 位图 Bitmap
> 	- 位域 Bitfield

>[!hint] 使用 `type 键` 来查看 value 的数据类型

# 字符串
## 创建
- `SET 键 值` 设置键值对
- `GETSET 键 值` 设置键值对，并返回旧 value【~~如果没有，则返回 nil ~~】
- `mset 键1 值 键2 值 ……` 一次性设置多个键值对
- `msetnx 键1 值 键2 值 ……` 当 key 不存在时，一次性设置多个键值对

```bash
# mset
127.0.0.1:6379> mset name2 docker name3 mysql
OK
127.0.0.1:6379> get name2
docker
127.0.0.1:6379> get name3
mysql
```

## 获取
- `GET 键` 
- `GETRANGE 键 索引1 索引2` 获取 value 中的指定范围的字符
- `MSET 键1 键2 ……` 一次性获取多个 value【如果 key 不存在，则返回 nil】
- `Strlen 键` 获取 value 的字符长度

## 修改
- `SETRANGE 键 索引 值` 将 value 中，指定索引之后的值，进行替换
- `append 键 值` 向 value 后面添加字符
- `incr 键` 如果 value 为数字，则将 value 加 1
- `incrby 键 值` 如果 value 为数字，则将 value 加上指定的值
- `incrbyfloat 键 值`  如果 value 为数字，则将 value 加上指定的浮点数值
- `decr 键` 如果 value 为数字，则将 value 减 1
- `decrby 键` ……

```bash
redis 127.0.0.1:6379> SET key1 "Hello World"
OK
redis 127.0.0.1:6379> SETRANGE key1 6 "Redis"
(integer) 11
redis 127.0.0.1:6379> GET key1
"Hello Redis"
```

## 删除
- `DEL 键`

```bash
SET name redis
GET name
DEL name

---
"redis"
```

# 列表 List
- **添加**
	- 左插入 `lpush 集合名 值` 
	- 右插入 `rpush 集合名 值` 
- **删除**
	- 左删除几个元素 `lpop 集合名 [数字]` 【不加数字表示删除一个】
	- 右删除几个元素 `rpop 集合名 [数字]`
	- 只保留索引 1 到索引 2 之间的元素 `LTRIM 集合名 索引1 索引2`
- **查看**
	- 查看列表元素个数 `LLEN 集合名` 
	- 按照索引遍历集合 `lrange 集合名 索引1 索引2` 【索引 2 如果是 “-1”，表示最后一个元素】

|序号|命令及描述|
|---|---|
|1|[BLPOP key1 [key2 ] timeout](https://www.runoob.com/redis/lists-blpop.html)  <br>移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。|
|2|[BRPOP key1 [key2 ] timeout](https://www.runoob.com/redis/lists-brpop.html)  <br>移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。|
|3|[BRPOPLPUSH source destination timeout](https://www.runoob.com/redis/lists-brpoplpush.html)  <br>从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。|
|4|[LINDEX key index](https://www.runoob.com/redis/lists-lindex.html)  <br>通过索引获取列表中的元素|
|5|[LINSERT key BEFORE\|AFTER pivot value](https://www.runoob.com/redis/lists-linsert.html)  <br>在列表的元素前或者后插入元素|
|6|[LLEN key](https://www.runoob.com/redis/lists-llen.html)  <br>获取列表长度|
|7|[LPOP key](https://www.runoob.com/redis/lists-lpop.html)  <br>移出并获取列表的第一个元素|
|8|[LPUSH key value1 [value2]](https://www.runoob.com/redis/lists-lpush.html)  <br>将一个或多个值插入到列表头部|
|9|[LPUSHX key value](https://www.runoob.com/redis/lists-lpushx.html)  <br>将一个值插入到已存在的列表头部|
|10|[LRANGE key start stop](https://www.runoob.com/redis/lists-lrange.html)  <br>获取列表指定范围内的元素|
|11|[LREM key count value](https://www.runoob.com/redis/lists-lrem.html)  <br>移除列表元素|
|12|[LSET key index value](https://www.runoob.com/redis/lists-lset.html)  <br>通过索引设置列表元素的值|
|13|[LTRIM key start stop](https://www.runoob.com/redis/lists-ltrim.html)  <br>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。|
|14|[RPOP key](https://www.runoob.com/redis/lists-rpop.html)  <br>移除列表的最后一个元素，返回值为移除的元素。|
|15|[RPOPLPUSH source destination](https://www.runoob.com/redis/lists-rpoplpush.html)  <br>移除列表的最后一个元素，并将该元素添加到另一个列表并返回|
|16|[RPUSH key value1 [value2]](https://www.runoob.com/redis/lists-rpush.html)  <br>在列表中添加一个或多个值到列表尾部|
|17|[RPUSHX key value](https://www.runoob.com/redis/lists-rpushx.html)  <br>为已存在的列表添加值|


```bash
# 会返回列表的长度
127.0.0.1:6379> lpush list1 rerere
(integer) 1

127.0.0.1:6379> lpush list1 rere2
(integer) 2

127.0.0.1:6379> rpush list1 rere3
(integer) 3

127.0.0.1:6379> lrange list1 0 2
1) "rere2"
2) "rerere"
3) "rere3"

# 从0开始遍历，知道最后一个元素
127.0.0.1:6379> lrange list1 0 -1
1) "rere2"
2) "rerere"
3) "rere3"
```

# 集合 Set
- **添加** `sadd 集合名 值` 
- **删除** `SREM 集合名 值`
- **查看**
	- 遍历 `smembers 集合名` 
	- 判断某个值是否在集合中 `SISMEMBER 集合名 值`

| 序号  | 命令及描述                                                                                                                         |
| --- | ----------------------------------------------------------------------------------------------------------------------------- |
| 1   | [SADD key member1 [member2]](https://www.runoob.com/redis/sets-sadd.html)  <br>向集合添加一个或多个成员                                   |
| 2   | [SCARD key](https://www.runoob.com/redis/sets-scard.html)  <br>获取集合的成员数                                                       |
| 3   | [SDIFF key1 [key2]](https://www.runoob.com/redis/sets-sdiff.html)  <br>返回第一个集合与其他集合之间的差异。                                     |
| 4   | [SDIFFSTORE destination key1 [key2]](https://www.runoob.com/redis/sets-sdiffstore.html)  <br>返回给定所有集合的差集并存储在 destination 中    |
| 5   | [SINTER key1 [key2]](https://www.runoob.com/redis/sets-sinter.html)  <br>返回给定所有集合的交集                                          |
| 6   | [SINTERSTORE destination key1 [key2]](https://www.runoob.com/redis/sets-sinterstore.html)  <br>返回给定所有集合的交集并存储在 destination 中  |
| 7   | [SISMEMBER key member](https://www.runoob.com/redis/sets-sismember.html)  <br>判断 member 元素是否是集合 key 的成员                       |
| 8   | [SMEMBERS key](https://www.runoob.com/redis/sets-smembers.html)  <br>返回集合中的所有成员                                               |
| 9   | [SMOVE source destination member](https://www.runoob.com/redis/sets-smove.html)  <br>将 member 元素从 source 集合移动到 destination 集合 |
| 10  | [SPOP key](https://www.runoob.com/redis/sets-spop.html)  <br>移除并返回集合中的一个随机元素                                                  |
| 11  | [SRANDMEMBER key [count]](https://www.runoob.com/redis/sets-srandmember.html)  <br>返回集合中一个或多个随机数                              |
| 12  | [SREM key member1 [member2]](https://www.runoob.com/redis/sets-srem.html)  <br>移除集合中一个或多个成员                                   |
| 13  | [SUNION key1 [key2]](https://www.runoob.com/redis/sets-sunion.html)  <br>返回所有给定集合的并集                                          |
| 14  | [SUNIONSTORE destination key1 [key2]](https://www.runoob.com/redis/sets-sunionstore.html)  <br>所有给定集合的并集存储在 destination 集合中   |
| 15  | [SSCAN key cursor [MATCH pattern] [COUNT count]](https://www.runoob.com/redis/sets-sscan.html)  <br>迭代集合中的元素                  |

```bash
127.0.0.1:6379> sadd set1 green
(integer) 1

127.0.0.1:6379> sadd set1 red
(integer) 1

# 返回0，表示集合中已经有了相同的值
127.0.0.1:6379> sadd set1 red
(integer) 0

127.0.0.1:6379> sadd set1 black
(integer) 1

127.0.0.1:6379> SMEMBERS set1
1) "green"
2) "red"
3) "black"

127.0.0.1:6379> SISMEMBER red
(integer) 1
```

# 有序集合 ZSet
- **添加**元素，和分数 `zadd 集合名 分数 值` 
- **查看**
	- 获取某个分数 `ZSCORE 集合名 值` 
	- 获取排名 `ZRANK 集合名 值`
	- 反向获取排名 `ZREVRANK 集合名 值`
	- 遍历
		- 根据分数范围遍历集合 `ZRANGEBYSCORE 集合名 分数1 分数2` 
		- 根据索引遍历值 `ZRANGE 集合名 索引1 索引2`
		- 根据索引遍历值，和分数 `ZRANGE 集合名 索引1 索引2 WITHSCORES`

| 序号  | 命令及描述                                                                                                                                                        |
| --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | [ZADD key score1 member1 [score2 member2]](https://www.runoob.com/redis/sorted-sets-zadd.html)  <br>向有序集合添加一个或多个成员，或者更新已存在成员的分数                              |
| 2   | [ZCARD key](https://www.runoob.com/redis/sorted-sets-zcard.html)  <br>获取有序集合的成员数                                                                             |
| 3   | [ZCOUNT key min max](https://www.runoob.com/redis/sorted-sets-zcount.html)  <br>计算在有序集合中指定区间分数的成员数                                                           |
| 4   | [ZINCRBY key increment member](https://www.runoob.com/redis/sorted-sets-zincrby.html)  <br>有序集合中对指定成员的分数加上增量 increment                                       |
| 5   | [ZINTERSTORE destination numkeys key [key ...]](https://www.runoob.com/redis/sorted-sets-zinterstore.html)  <br>计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 destination 中 |
| 6   | [ZLEXCOUNT key min max](https://www.runoob.com/redis/sorted-sets-zlexcount.html)  <br>在有序集合中计算指定字典区间内成员数量                                                    |
| 7   | [ZRANGE key start stop [WITHSCORES]](https://www.runoob.com/redis/sorted-sets-zrange.html)  <br>通过索引区间返回有序集合指定区间内的成员                                         |
| 8   | [ZRANGEBYLEX key min max [LIMIT offset count]](https://www.runoob.com/redis/sorted-sets-zrangebylex.html)  <br>通过字典区间返回有序集合的成员                               |
| 9   | [ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT]](https://www.runoob.com/redis/sorted-sets-zrangebyscore.html)  <br>通过分数返回有序集合指定区间内的成员                        |
| 10  | [ZRANK key member](https://www.runoob.com/redis/sorted-sets-zrank.html)  <br>返回有序集合中指定成员的索引                                                                  |
| 11  | [ZREM key member [member ...]](https://www.runoob.com/redis/sorted-sets-zrem.html)  <br>移除有序集合中的一个或多个成员                                                      |
| 12  | [ZREMRANGEBYLEX key min max](https://www.runoob.com/redis/sorted-sets-zremrangebylex.html)  <br>移除有序集合中给定的字典区间的所有成员                                          |
| 13  | [ZREMRANGEBYRANK key start stop](https://www.runoob.com/redis/sorted-sets-zremrangebyrank.html)  <br>移除有序集合中给定的排名区间的所有成员                                     |
| 14  | [ZREMRANGEBYSCORE key min max](https://www.runoob.com/redis/sorted-sets-zremrangebyscore.html)  <br>移除有序集合中给定的分数区间的所有成员                                      |
| 15  | [ZREVRANGE key start stop [WITHSCORES]](https://www.runoob.com/redis/sorted-sets-zrevrange.html)  <br>返回有序集中指定区间内的成员，通过索引，分数从高到低                             |
| 16  | [ZREVRANGEBYSCORE key max min [WITHSCORES]](https://www.runoob.com/redis/sorted-sets-zrevrangebyscore.html)  <br>返回有序集中指定分数区间内的成员，分数从高到低排序                   |
| 17  | [ZREVRANK key member](https://www.runoob.com/redis/sorted-sets-zrevrank.html)  <br>返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序                                        |
| 18  | [ZSCORE key member](https://www.runoob.com/redis/sorted-sets-zscore.html)  <br>返回有序集中，成员的分数值                                                                 |
| 19  | [ZUNIONSTORE destination numkeys key [key ...]](https://www.runoob.com/redis/sorted-sets-zunionstore.html)  <br>计算给定的一个或多个有序集的并集，并存储在新的 key 中                |
| 20  | [ZSCAN key cursor [MATCH pattern] [COUNT count]](https://www.runoob.com/redis/sorted-sets-zscan.html)  <br>迭代有序集合中的元素（包括元素成员和元素分值）                           |

```bash
redis 127.0.0.1:6379> zadd runoob 0 redis
(integer) 1

redis 127.0.0.1:6379> zadd runoob 0 mongodb
(integer) 1

redis 127.0.0.1:6379> zadd runoob 0 rabbitmq
(integer) 1

redis 127.0.0.1:6379> ZRANGEBYSCORE runoob 0 1000
1) "mongodb"
2) "rabbitmq"
3) "redis"
```

# 哈希 Hash
- **创建**
	- `hset 集合名 键 值` 
	- `HMSET 集合名 键名1 值1 键名2 值2 ……` 一次设置多个键值对 

---

- **获取**
	- `HGET 集合名 键名` 查看某个 value
	- `hmget 集合名 键1 键2 ……` 
	- `hexists 集合名 键` 查看键是否存在
	- `hgetall 集合名` 查看所有的 key，和 value
	- `hkeys 集合名` 查看哈希表中所有的 key
	- `hvals 集合名` 查看哈希表中所有的 value
	- `hlen 集合名` 获取哈希表中 key 的数量

---

- **修改**
	- `hincrby 集合 键 增值`
	- `hincrbyfloat ……`

---

- **删除** `hdel 集合名 键1 键2 ……` 删除集合中，指定个键值对

---

```bash
redis 127.0.0.1:6379> HMSET runoob field1 "Hello" field2 "World"
"OK"

redis 127.0.0.1:6379> HGET runoob field1
"Hello"

redis 127.0.0.1:6379> HGET runoob field2
"World"

redis 127.0.0.1:6379> DEL runoob
(integer) 1
```

# 高级数据结构
## HyperLogLog
>[!quote] HyperLogLog
>>HyperLogLog  是用来做<u>基数估计</u>的算法
>
>HyperLogLog 的**优点**：
>- 无论输入元素的数量有多大，它所需的存储空间总是固定的，且非常小
>- 虽然有误差，但是可以精确地估计自己的误差【~~我们可以知道自己的估计结果有多准确~~】
>
>HyperLogLog 的**缺点**：
>- 只会根据输入元素来计算基数，而不会储存输入元素本身

>[!quote] 基数
>基数 就是<u>一个数据集中不重复的元素</u>，比如有一个数据集 {1, 3, 5, 7, 5, 7, 8}，那么这个数据集的基数集就为 {1, 3, 5 ,7, 8}，基数为 5

>[!quote] 基数估计
>基数估计 就是在<u>误差可接受</u>的范围内，<u>快速计算</u>基数

---

>[!hint] 每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数

|序号|命令及描述|
|---|---|
|1|[PFADD key element [element ...]](https://www.runoob.com/redis/hyperloglog-pfadd.html)  <br>添加指定元素到 HyperLogLog 中。|
|2|[PFCOUNT key [key ...]](https://www.runoob.com/redis/hyperloglog-pfcount.html)  <br>返回给定 HyperLogLog 的基数估算值。|
|3|[PFMERGE destkey sourcekey [sourcekey ...]](https://www.runoob.com/redis/hyperloglog-pfmerge.html)  <br>将多个 HyperLogLog 合并为一个 HyperLogLog|

```bash
# 例子
redis 127.0.0.1:6379> PFADD runoobkey "redis"
1) (integer) 1

redis 127.0.0.1:6379> PFADD runoobkey "mongodb"
1) (integer) 1

redis 127.0.0.1:6379> PFADD runoobkey "mysql"
1) (integer) 1

redis 127.0.0.1:6379> PFCOUNT runoobkey
(integer) 3
```

## 消息队列 Stream
>[!quote] 消息队列 Stream
>消息队列 Stream 是一种持久化的消息队列系统，Stream中的消息会被持久化存储，即使在消息发布的时候，订阅者没有在线，他们也能在后来获取到这个消息。此外，Stream还支持消费者组，可以实现分布式的消息消费



















