---
tags:
  - 计算机/四大件
---
# 网络的全貌
浏览器和Web服务器之间的交互却很简单，概括如下：
(1)浏览器向Web服务器发送请求；
(2)Web服务器根据请求向浏览器发送响应；

要实现应用程序之间的交互，我们需要一个能够在浏览器和Web服务器之间传递请求和响应的机制。网络是由很多计算机等设备相互连接组成的，因此在通信的过程中需要确定正确的通信对象，并将请求和响应发送给它们。请求和响应在传递的过程中可能会丢失或损坏【请求和响应本质都是电信号和光信号，这些信号可能会因收到杂音等干扰而损坏】。所以需要一种机制，无论遇到任何情况都能够将请求和响应准确无误地发送给对方。
这种机制是由操作系统中的网络控制软件，以及交换机、路由器等设备分工合作来实现的，它的基本思路是将数字信息分割成一个一个的小块，然后装入一些被称为“包”(Packet)的容器中来运送。大家可以这样理解：包相当于信件或者包裹，而交换机和路由器则相当于邮局或快递公司的分拣处理区。包的头部存有目的地等控制信息，通过许多交换机和路由器的接力，就可以根据控制信息对这些包进行分拣，然后将它们一步一步地搬运到目的地。
无论是家庭和公司里的局域网，还是外面的互联网，它们只是在规模上有所不同，基本的机制都是相同的。

前面介绍的这个负责搬运数字信息的机制，再加上浏览器和Web服务器这些网络应用程序，这两部分就组成了网络。
# 基础概念知识
### URL
> 形如“http://”、“ftp://”、“file://”、“mailto://”等开头的链接，所以浏览器是一个具备多种客户端功能的综合性客户端软件，而URL的开头就是告诉浏览器使用其中哪种功能来访问相应的数据

`http://user:password@www.glasscom.com:80/dir/file1.htm`  --会包含服务器的域名，文件的路径
`ftp://user:password@ftp.glasscom.com:21/dir/file1.htm`
`file://localhost/c:/path/file1.zip`
`mailto:tone@glasscom.com`  --会包含收件人的邮件地址

***URL中还可能包含用户名，密码，端口号等信息***
##### URL省略文件名
- `http://www.lab.glasscom.com/dir/`---这种时候服务器就会访问`/dir/index.html`或`/dir/default.htm`
- `http://www.lab.glasscom.com/`---这表示服务器会访问***根目录***
- `http://www.lab.glasscom.com/`---这时会访问服务器根目录下的`index.html`或者`default.htm`文件
##### URL的层次结构
通过`.`来分割层级，***越靠右的层级越高***
```
例如 www.nikkeibp.co.jp
jp代表分配给日本这个国家的域，这个域的下一级又有很多域，co就是其中之一；
co代表公司的域，公司有很多公司，nikkeibp就是其中之一；
nikkeibp代表分配给这家公司的域
```
### TCP/IP
>TCP/IP就是由一些小的子网【由集线器连接起来的几台计算机】，通过路由器连接起来组成一个大的网络
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=E5YjsPvZ|540]]
> 发送者发出的消息首先经过子网中的<u>集线器A</u>，转发到距离发送者最近的<u>路由器A</u>上，接着这个<u>路由器A</u>会根据目的地的位置判断要传送的下一个<u>路由器B</u>【传送到下一个子网的<u>集线器B</u>，再到<u>路由器B</u>】……直到到达目的地

***集线器***：按照以太网规则传输包的设备，集线器可以在子网中将网络包传输到下一个路由器
***路由器***：按照IP规则传输包的设备，路由器可以根据目标地址判断下一个路由器的位置
##### 地址
###### IP地址
>在同一网络下可以唯一标识的标识号，表示***网络号***+***主机号***。例如`10.11.12.13`

但由于网络号和主机号的具体结构是不固定的，所以我们要引入***子网掩码***来区分

>[!faq] 如何解决IP地址不足的问题？
>将公司内网分成***对互联网开放的服务器***【配公有地址（原来的固定地址，可以和互联网直接通信）】和***公司内部设备***【配私有地址（这些地址只能用于内网）】。那么现在A公司的某台服务器和B公司的某台客户端具有相同的IP地址也没关系。
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=fmkubkxZ|500]]
>私有地址的范围：
>10.0.0.0~10.255.255.255；
>172.16.0.0~172.31.255.255；
>192.168.0.0~192.168.255.255
>
###### 子网掩码
>子网掩码表示网络号与主机号之间的边界

子网掩码的表示方式：
- 十进制加分隔号`10.11.12.13/255.255.255.0`
- 网络号比特数`10.11.12.13/24`
###### MAC地址
- [ ] MAC地址的结构
>MAC地址长48bit。有两种写法：
>- `00-80-C8-2D-82-EA`
>- `00:80:C8:2D:82:EA`

- [ ] 如何知道目标的MAC地址？
> ***通过ARP协议查询目标路由器的MAC地址***：在以太网中，会通过广播把包发给连接在以太网中的所有设备。ARP会向所有设备提问“这个IP地址是谁的？请把你的MAC地址告诉我”，如果对方存在则会回应；如果路由表设置不正确，则只能认为对方不存在，包的发送就会失败。
##### DNS服务器
>域名服务系统，将IP地址与域名进行关联
###### DNS与域的关系
一台DNS服务器只能存储一个或者多个完整的域【比如`.com`域底下分了分多个层级，例如`.example`,`.google`等，那么一台DNS服务器只能完整的存储`.example`这个域，不能这台存一点`.example`，另一台又存一点`.example`】，当然全世界也可以只用一台DNS把`.com`这个域全部存了，但是太多了，只能分层
###### 缓存机制
每次查询IP地址都要从根域服务器开始那就效率太低了，所以DNS服务器里会有缓存，***可以记住之前查询过的域名***，下次查询可以快速响应。由于原本的域名注册信息会改变，这就会导致缓存里的注册信息是错误的，***所以缓存信息是有有效期的***
##### TCP协议
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=ns2tkUMG|450]]
###### 如何建立管道和销毁管道
- 首先服务器先创建***套接字***【管道两端的数据出入口】【创建套接字后，协议栈会返回描述符（”号码牌“），因为浏览器可能要打开多个网页，所以也会有多个套接字，描述符用来标识套接字】，之后等待客户端连接管道；之后客户端也创建套接字，然后从该套接字延伸管道，连接到服务器端的套接字上。
- 当数据传送完毕之后，断开管道可以由任何一方发起，之后套接字随之销毁
>[!question] TCP是如何确定对方是否收到信息的？
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=4ZCrpyHv|800]]
###### TCP/IP包
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=NjKGz5z2|500]]
***IP头部***：包含自己网卡的IP地址，目的地的IP地址，协议号【包的内容类型】及其他信息
***MAC头部***：包含发送方和接收方的MAC地址，以太类型【IP协议，ARP协议，IPv6协议】

>[!question] 包是如何传输的？
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=N1r8Nq1n|600]]
>1. 网络包中有下一个路由器R1的MAC地址，有目的地服务器S的IP地址；
>2. 首先网络包会经过集线器，集线器通过包中的MAC头部信息，查找以太网表知道这个包该发往哪个路由器；
>3. 传输到<u>路由器R1</u>后根据IP表，知道要发往的下一个路由器的位置，但是为了发过去我们还需要查出下一个<u>路由器R2</u>的MAC地址，然后改写MAC头部；
>4. …………；
>5. 直到送达目的地；
##### UDP协议
UDP协议只负责发送包，出错时就收不到对方的回复，应用程序会注意到这个问题，会重新发送一遍数据
###### 什么情况下使用UDP协议？
- [ ] 数据很短，用一个包就能装得下的情况下【因为只有一个包，就不用考虑哪个包未送达了，就算重发也就是重发一个包】。***例如DNS查询***
- [ ] 重发数据也没什么意义时。***例如发送音频和视频数据时***【因为音频和视频必须在短时间内送达，不然会引起卡顿掉帧，而TCP协议繁琐的传输流程不合适，而且音频和视频缺少某些包一般可以接受】

==当需要穿越防火墙传输音频和视频数据时，我们有时会使用TCP协议【因为UDP经常会被防火墙阻止】==
##### 以太网
>以太网是一种为多台计算机能够彼此自由和廉价地互相通信而设计的通信技术

***IP协议本身没有传输包的功能，包的实际传输要委托以太网来完成***
###### 以太网的进化历史
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=qaHryAp7]]
>- [ ] (a)
>	***当一台计算机发送信号时，信号会通过网线流过整个网络，最终到达所有的设备***
>	收发器：将不同网线之间的信号连接起来
>
>- [ ] (b)
> 后来(a)变成了(b)，(b)的信号依旧会发送给所有设备，但是将主干网线-->中继式集线器【集线器】，将收发器网线-->双绞线
> 
>- [ ] (c)
>   交换式集线器被称为***交换机***
###### 以太网的特点
- [ ] 自动协商：确定最优的传输速率
>当两台设备通电并完成硬件初始化之后，就会开始用脉冲信号发送自己支持的速率【木桶效应】和工作模式【全/半双工】
##### 局域网LAN
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=bCkH68Rs]]
##### 设备
###### 网卡
>***网卡***可能是<u>计算机主板上的板卡</u>，<u>笔记本上的PCMCIA卡</u>，或者是<u>计算机主板上集成的芯片</u>

- [ ] 内部结构
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=KlPCtkvx|600]]
###### 集线器
现在我们基本不使用集线器了，而是直接将计算机连接到交换机上
###### 交换机
>交换机 = 计算机 + 多块网卡 + 开启“混杂模式”【让网卡接收所有的包】+ 安装网络包转发软件

- [ ] 交换机中的MAC表是如何维护的？
>- 当<u>发送方</u>向交换机发送包时，交换机会记录发送方的MAC地址和包进入交换机时的端口号。【***以便以后要向该发送方发送包时，交换机可以快速反应***】
>- MAC表会在一段时间删除一些记录【防止终端设备移动产生问题】

>[!question] 网卡与交换机的区别
>- ***网卡本身具有MAC地址***，***而交换机的端口不具有MAC地址***
>- ***网卡会根据MAC地址核对包是不是发给自己的***，***而交换机则接收所有的包并存放到缓冲区***

>[!question] 集线器与交换机的区别
>- ***交换机具有更好的性能和碰撞管理能力***
>- ***交换机会根据MAC地址将包发送到正确的端口，而不是广播。从而减少了碰撞的可能性***
>- 交换机的端口速度和带宽远高于集线器
###### 路由器
我们的家用路由器已经集成了<u>集线器</u>，<u>交换机</u>的功能
- [ ] 路由器的内部结构
> ![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=c8bABV8y|600]]
> ***转发模块***：负责判断包的转发目的地，类似于==IP模块==
> ***端口模块***：负责包的收发操作，类似于==网卡==

- [ ] 路由器的功能

>*地址转换*：在转发网络包时对<u>IP头部</u>中的 IP地址 和 端口号[^2] 进行改写
>>假设现在要访问Web服务器：
>>- 首先，TCP连接操作的***第一个包***被转发到互联网时，会将发送方IP地址从私有地址改写成公有地址[^3]
>>- 接着，地址转换设备会随机生成一个空闲端口，并改写前私有地址的端口号
>>- 最后，将改写前和改写后的 地址 和 端口号 作为一组对应的记录保存在地址转换设备内部的表中
>>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=OyGYltBf|500]]

>*包过滤*[^4]：在队报进行转发时，根据MAC头部，IP头部，TCP头部的内容，按照事先设置好的规则决定是 转发/丢弃 这个包

[^2]:指的是TCP和UDP的端口号，不是路由器和集线器连接网线的那个端口
[^3]:此处为地址转换设备的互联网接入端口的地址
[^4]:大多数防火墙设备/软件都是利用这一机制来防止非法入侵的

>[!question] 交换机与路由器的区别
>***交换机是基于 以太网 设计的***
>***路由器是基于 IP 设计的***，路由器的每个端口都有<u>MAC地址</u>和<u>IP地址</u>
>==路由器委托交换机传输包==
### 接入网
>接入网：连接互联网与家庭、公司网络的通信线路。一般家用的接入网方式包括ADSL，FTTH，CATV，电话线，ISDN等；公司还可能会使用专线

互联网接入路由器 与 以太网路由器 不同，互联网接入路由器是按照接入网规则来发送包的
##### 接入网中使用的PPP和隧道
###### 用户认证和配置下发
ADSL 和 FTTH 接入网中，用户和BAS【用户端的】之间都是通过电缆/光纤固定连接的，因此不需要验证用户身份。但是通过用户名和密码，可以***运营商更好地管理用户***，***用户可以根据用户名来切换不同的运营商***。因此，接入运营商在 ADSL 和 FTTH 中会使用 PPPoE[^11]，BAS[^12]就是登录操作的窗口。

[^11]:有些运营商不使用PPP，而是使用DHCP
[^12]:这里的BAS是运营商端的
###### PPP
> *在使用电话线/ISDN拨号上网时，PPP的工作流程：*
> - 首先，用户向运营商的接入点拨打电话  ①-1
> - 电话接通  ①-2
> - 输入用户名和密码进行登录操作  ②-2
> - 用户名和密码通过 RADIUS协议[^9] 从 RAS[^10] 发送到认证服务器进行校验
> - 确认无误后，认证服务器会返回IP地址等配置信息，并下发给用户  ②-3
> - 用户端的设备根据服务器返回的配置信息，完成收发网络包的准备工作
> ![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=jmpoEsTO|600]]

> *PPP如何传输消息：*
> 将 PPP消息 装进一个包含<u>报头</u>，<u>FCS</u>，<u>信号格式</u>的容器里，然后以 HDLC协议[^13] 发送出去
> ![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=HpDa4Qc9|600]]

[^9]:远程认证拨号用户服务
[^10]:远程访问服务器
[^13]:原本是为在专线中传输网络包而设计的，拨号接入方式对HDLC进行了修正，然后使用
###### PPPoE
> PPPoE = PPP + 以太网

由于，ADSL 和 FTTH 不能使用 HDLC ，所以我们用了以太网进行代替
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=pSfebJIu|900]]
>*PPPoE包*
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=5nBXlO7U|540]]
###### PPPoA
只有ADSL接入网可以使用PPPoA【因为FTTH不使用<u>ATM信元</u>】
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=iznefzjS|540]]
使用PPPoA时，***需要和BAS收发PPP消息的设备【计算机，路由器】必须和ADSL Modem是一体的***【因为PPPoA没有MAC头部，PPP消息无法通过以太网传输】

一体化的方式主要有以下两种：
- 第一种是将计算机和 ADSL Modem 用 USB 接口连接起来，这样 ADSL Modem 就和计算机成为一体了【最终并没有普及】
- 另一种方式是将 ADSL Modem 和路由器整合成一台设备。【这种方式无法抛开路由器用计算机直接上网】

PPPoA 相比 PPPoE 可以传输更大的包【因为没有PPPoE头部，PPP头】
###### 隧道
>隧道就类似于套接字之间建立的TCP连接，只不过这里的套接字是***BAS***

>*基于TCP连接的隧道*
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=3XYAysn0|520]]
>- 首先需要在网络上的两台隧道路由器【有时是服务器】之间建立TCP连接
>- 然后，将连接两端的套接字当作路由器的端口，从这个端口收发数据

>*基于封装的隧道*
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=vbp19H5N|520]]
>将包含头部在内的整个包装入另一个包中传输到另一端【包可以原封不动地到达另一端】
##### 接入网中使用的DHCP
>有一些运营商不使用 PPP，他们使用 DHCP协议 从 BAS 向用户端下发 TCP/IP配置信息。 

DHCP 经常用于通过公司网络向客户端计算机下发 TCP/IP 配置信息

>*DHCP的原理*
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=GdnbPjgDYIAw-kRXlJBwd]]
>- 首先客户端请求配置信息  ①
>- 然后DHCP服务器下发配置信息  ②

>*优点：*
>- 不需要像PPP那样需要多个步骤
>- 也不需要验证用户名和密码
>- 它可以单纯地直接传输以太网包，不需要添加额外的 PPP头部，因此不会占用 MTU

采用 DHCP的运营商使用的 ADSL Modem 不使用信元【使用信元的 PPPoE，PPPoA 方式中，BAS 需要配备比较昂贵的ATM接口】，而是直接将以太网包调制成 ADSL信号，因此没有 ADSL Modem 和路由器无法分离的问题
# Web浏览器
##### URL的解析
>生成HTTP请求之前需要对URL进行解析，确定Web服务器和文件名
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=nSIrYw3N|730]]
##### 生成HTTP请求信息
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=dzfRQA4Y|900]]
>***一条请求消息中只能写一条URI，如果要获取多个文件，必须对每个文件单独发送一条请求***
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=VVmY6Z7i|700]]

###### 方法
`GET`--获取URI指定的信息【如果URI是文件，则返回文件内容；如果URI是CGI程序，则返回输出结果】
`POST`--从客户端向服务端发送数据【一般用于发送<u>表单</u>[^1]中填写的数据】
`HEAD`--只从服务端返回消息头给客户端【用于获取文件最后更新时间等属性】
`OPTIONS`--用于通知或查询通信选项
`PUT`--替换URI指定的服务器上的文件，如果文件不存在，则创建该文件
`DELETE`--删除URI指定的服务器上的文件
`TRACE`--将服务器收到的请求行和头部直接返回给客户端【用于在使用代理的环境中检查改写请求】
`CONNECT`--使用代理传输加密消息

###### 消息头
- ***通用头***：适用于请求和响应消息的头字段
- ***请求头***：给请求消息添加附加消息
- ***响应头***：给响应消息添加附加消息
- ***实体头***：给消息体添加附加消息

[^1]:网页中的文本框，复选框等能够输入数据的部分
### 域名解析
>[!question] 为什么不直接在Web浏览器输入IP地址，还要域名干嘛？
>如果对方的服务器不使用虚拟主机的话，直接输入IP地址也是可以访问网页的。***但是对比于一串数字，域名更加好记啊***

>[!question] 那为什么不直接用域名来确定通信对象呢?
>IPv4地址只有32bit，域名是字符串占用内存太多，***增加服务器负担，效率低下***

##### 通过解析器向DNS服务器发送查询信息
解析器【解析器实际上是一段程序，它包含在操作系统的`Socket库`【网络开发的标准库】中】会生成查询消息，之后委托给操作系统内部的协议栈发送查询消息给DNS服务器，最后通过网卡发送出去
```mermaid
graph LR
	a[应用程序]--调用-->b[解析器]--委托-->c[协议栈]--委托-->d[网卡]--发送消息-->e[DNS服务器]
	
	e--返回响应消息-->d--返回消息-->c--返回消息-->b--返回消息-->a
```
##### 接收DNS服务器返回的响应消息，并解析
解析得到IP地址后，将其写入到Web浏览器的内存地址中，后续浏览器向Web服务器发送消息时，只要从该内存地址取出IP地址，并将其和HTTP请求消息一起交给操作系统即可
### 全世界DNS服务器的大接力
全世界的每台DNS服务器都具有根域服务器的IP地址，所以客户端只要能找到一台DNS服务器就可以找到根域服务器【但是查询的过程中，最近的DNS服务器会一直询问，直到找到IP地址】
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=ROH2XNi4|600]]
有了这些条件，接下来就是应用程序委托***协议栈***发送消息了
# 协议栈
***协议栈***：网络控制软件
***网卡***：网络硬件

>协议栈的内部结构：
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=mSlDrTNw]]
>***ICMP协议***：用于告知网络包传送过程中产生的错误以及各种控制信息
>***ARP协议***：用于根据IP地址查询相应的***以太网MAC地址***
### 使用TCP协议传输
##### 创建套接字
- 准备创建套接字【套接字就是存放控制信息（IP地址，端口号，通信状态）的内存空间的抽象概念】
- 协议栈向操作系统申请内存空间来放置套接字，并将套接字设为初始状态
- 套接字创建成功之后，协议栈会返回一个描述符给应用程序，用于唯一标识套接字
##### 连接Web服务器
- 服务器程序一般会在系统启动时就创建套接字，***等待服务端进行连接***
- 之后TCP模块会把包含控制信息的***以太网头部***，***TCP头部***的网络包委托给***IP模块***进行发送
- 等到服务器端的***IP模块***接收到信息后，就把信息传递给服务器端的***TCP模块***，服务器根据这些信息就知道自己要使用哪个套接字，也知道了客户端的信息。
- 服务端会修改套接字的状态
- 服务端向客户端发送信息，告诉客户端已收到，可以进行连接
- 客户端收到信息后，会再次给服务端发信息说，我收到了
- 至此，连接完成
>[!question] 为什么最后还要多此一举向服务器端发送消息？
>最后一次是客户端向服务器端发送网络包的随机序列号，我们不能真的从1开始傻傻的排序，因为这样通信过程很容易被预测，容易被攻击，***所以起始序列号必须随机***
##### 收发数据
指定***描述符***和***需要发送的数据***，协议栈通过***套接字***【连接成功后，套接字中会有通信对方的信息，所以发送数据无需指明***IP地址***和***端口号***】把数据发送给Web服务器
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=No6ib08t|600]]
>发送时，发送方会说“现在发送的是从xx字节开始的部分，一共有xx字节”
>接收方则回复说“到xx字节之前的数据我已经收到了”
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=H9yqiQ8G|530]]
##### 断开连接
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=UZ67GJjD|520]]
##### 删除套接字
为了***防止误操作***，删除套接字要过一段时间
```
在断开连接时，服务器最后发送给客户端的ACK号丢失了，那么客户端会再次发送一个 FIN:1的包。
如果这时服务器端的套接字已经删除了，更巧的是，某个在服务器端的另一个程序重新创建的套接字的端口号与刚刚被删除的套接字的端口号一样，那。。。接下来的通信就是“牛头不对马嘴”
```

经过协议栈之后，我们就已经得到了带有各种控制信息的包，接下来我们把包交给网卡进行传输
# 网卡
```mermaid
graph LR
	a(协议栈)--带有0和1的数字信号的网络包-->b(网卡)--电信号/光信号-->c(网线/光纤)
	c-->d(路由器,集线器等转发设备)
	d-->e(接收方)
```
### 网卡将包转换成电信号通过网线发送出去
网卡驱动从IP模块获取包之后，会将其复制到网卡内的缓冲区中；
接下来MAC模块会将包从缓冲区中取出，并在开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列；
***之后网卡的MAC模块生成电信号【通用信号】，然后由PHY(MAU)模块转换成可在网线中传输的格式，并通过网线发送出去***
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=ZpB4IHEP|500]]
# 网线
### 传输电信号
>[!question] 怎么解决传输时电信号的衰减？
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=8iOnlDvg|500]]
>***使用双绞线【将两根信号线缠绕在一起形成一组】***
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=pZqxXexl|600]]

# 集线器，交换机，路由器
### 集线器收到来自网线的信号
当信号到达集线器后，会被广播到连接集线器的所有设备，这些设备收到信号之后会通过MAC地址判断是不是发给自己的【是则接收，否则忽略】
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=fWnWn5MN|570]]
### 交换机收到来自集线器的信号
信号到达交换机之后的处理与网卡基本相同【==可以认为交换机的每个网线接口和后面的电路部分都是一块网卡==】：
- 信号到达网线接口，由PHY(MAU)模块进行接收，并将信号转换为通用格式传递给MAC模块
- MAC模块将信号转换为数字信息，之后校验FCS【没问题则放入缓冲区，否则丢弃】
- 包放入缓冲区后，则根据MAC表查询接收方的MAC地址应该通过哪个端口发送出去【有记录则发送，无记录则广播】
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=Po3EOEWg|570]]
### 路由器收到来自交换机的信号
- 首先，根据对应的通信技术【以太网/无线局域网】将从端口发送过来的包接收进来
- 接下来，转发模块会根据包的 IP头部 在路由表中查询
>查询时只匹配网络号，忽略主机号，根据<u>子网掩码</u>来决定发送的优先级，无选项时选择<u>默认网关</u>：
>>例如，要发送一个包到`192.168.1.10`服务器：
>>- 首先根据子网掩码判断符合对象，第三行的子网掩码表示只判断前 24 个bit位，所以第三行符合要求；第四行也符合要求；第五行的子网掩码表示需要符合的bit位是0，所以也符合。
>>- 接着是确定优先级：子网掩码位数越多，优先级越高，因为范围越小。第四行的目标地址根据子网掩码可以判断是一个服务器的地址；第三行是一个子网地址；
>>- 把包发送给第四行的地址，如果符合则结束，否则发送给下一优先级的地址
>>- 如果前面的地址都不匹配，则发送给***默认网关***【第五行】
>>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=fP0Bxd5i|500]]
- 更新<u>IP头部</u>的TTL有效期[^5]
>发送方在发送包时会将TTL设为 64/128，包每经过一个路由器的转发，TTL就会减 1，当TTL的值变成0时，这个包就会被丢弃【在互联网上发送包最多也就经过几十个路由器】

- 转发模块将包转移到对应端口，端口按照硬件的规则【以太网等】将包发送出去

如果输出端口为以太网，则发送出去的网络包会通过<u>交换机</u>到达下一个<u>路由器</u>。如果网络包的目标服务器位于家庭，公司网络中，那就不需要通过接入网路由器，也就不用进入互联网，而是直接转发给目标服务器；否则网络包会到达<u>接入网路由器</u>

[^5]:这个机制是为了防止包在一个地方陷入死循环
# 接入网，网络运营商
>接入网是指用户通过各种技术手段【如光纤、电缆、DSL等】将自己的设备连接到互联网的网络

>网络运营商是提供互联网接入和通信服务的公司或组织。

用户通过接入网将自己的设备接入到网络运营商的网络中，从而获取互联网服务
### 准备工作
- 首先，接入路由器会根据PPPoE的发现机制[^14]来寻找运营商端的BAS：
	- 用户询问：”BAS在不在？在的话报告MAC地址“
	- BAS回答：”我在这里，我的MAC地址是xx:xx:xx:xx:xx:xx“
- 接下来，是用户认证阶段
	- 用户名和密码通过***CHAP***[^15]方式发送给BAS
	- 用户名和密码通过***PAP***[^16]方式发送给BAS
- 然后，是BAS向用户下发配置信息[^17]
	- 路由器会根据这些信息配置自身的参数【路由器的BAS端口配置公有地址，路由表中配置默认网关】
- 接下来，互联网接入路由器进行地址转换
	- 如果不使用路由器来上网，BAS下发的配置信息就会直接配置在计算机上【相当于计算机有了公有地址】，这种情况下***无需地址转换***
	- 如果使用路由器来上网，BAS下发的参数就会被配置在路由器上【公有地址是分配给路由器的】。这时，***计算机会被分配一个私有地址，计算机发送的包需要通过路由器进行地址转换然后再转发到互联网中***。有些应用程序【网络电话、聊天、对战游戏等】会因为地址转换无法正常工作【因为有些应用程序需要将自己的IP地址告知通信对象或者告知控制服务器，但在有地址转换的情况下这些操作无法完成】，但现在已经有很多解决方案，因此不能说这些应用程序全都不能正常工作

==一对一连接的端口可以不分配IP地址==【因为网络包不管如何都会被送到另一端】

不用路由器上网会有危险【因为计算机拥有公有地址，这意味着来自互联网的包可以直接到达计算机，这可能导致计算 机被攻击】，因此，对于直接上网的客户端计算机，我们应该采取安装防火 墙软件等防御手段。

>[!faq] ***CHAP***与***PAP***的安全性？
>进行加密的CHAP安全性更高。但是也不是说使用PAP密码就立刻会被窃取。由于明文密码只在运营商端BAS和用户端路由器之间传输【从运营商端BAS向认证服务器发送密码时使用 RADIUS协议，无论用户拨入使用CHAP还是PAP，都是加密的】。
>
>所以如果要窃取密码，就要在路由器和 ADSL Modem 中间进行窃听

[^14]:基于广播来实现
[^15]:挑战握手认证协议
[^16]:密码认证协议
[^17]:配置信息包括分配给上网设备的 IP地址【公有地址】、DNS服务器的IP地址、默认网关的IP地址
### 发送网络包
##### 使用ADSL接入网
>ADSL是一种利用架设在电线杆上的金属电话线来进行高速通信的技术

ADSL接入网的上行方向【用户到互联网】和下行方向【互联网到用户】的通信速率是不同的
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=p215RiZm|900]]
- 首先，客户端生成的网络包到达互联网接入路由器后，在此处从以太网包中取出IP包并判断转发目标  ①~④
- 接下来，如果互联网接入路由器和 ADSL Modem 之间是通过以太网连接的，网络包会加上 MAC 头部、PPPoE 头部、PPP 头部总共 3 种头部[^8]，然后按照以太网规则发送出去  ⑤
- 接着，包就到达了 ADSL Modem 后，包会被拆分成很多小格子，每一个小格子称为一个信元【更小一号的包】，并将其转换为电信号  ⑥~⑧
- 然后，电信号会进入一个叫作<u>分离器</u>[^6]的设备与电话的语音信号混合起来
- 之后，从分离器出来，会通过室内电话线，然后到达外部电话线
- 接下来，信号会进入电线杆上架设的电话电缆【如果在电话局附近，电话电缆是埋在地下的】信号通过电话线到达电话局之后，会经过配线盘、分离器到达 DSLAM【多个 ADSL Modem 整合在一个外壳里的设备】
- ***DSLAM 会把电信号还原成信元，并发送给BAS***[^7]  ⑨~⑩
- 之后，BAS 将接收到的 ATM信元 还原成原始的网络包  ⑪~⑫
- 接下来，它会将收到的包前面的 MAC头部 和 PPPoE头部 丢弃，取出 PPP头部以及后面的数据  ⑬
- 接着，BAS 会在包的前面加上隧道专用头部，发送到隧道的出口  ⑭
- 然后，网络包到达隧道出口的隧道专用路由器后，会丢弃隧道头部，取出IP包，并被转发到互联网内部  ⑮~⑰

[^6]:分离器的作用是在信号从电话线传入的时候，负责将 电话 和 ADSL的信号 进行分离
[^7]:BAS：包转发设备
[^8]:MAC头部 和 PPPoE头部 的作用就是将包送达 BAS 的接口

![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=KVDJHycr|900]]
##### 使用FTTH
>FTTH是一种宽带接入技术，叫作“光纤到户”

数字信息需要先转换成电信号，再转换成光信号【`1`为高电压表示发光，`0`为低电压表示发暗，将这样的电信号输入LED、激光二极管等光源后，它们就会根据电压的变化发光】

FTTH有直连和分路两种形态
###### 使用直连
>用一根光纤直接从用户端连接到最近的电话局，***通过不同的波长来区分上行/下行光信号***

![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=dSKmYsXg|900]]
- 首先，用户端的光纤收发器将以太网的电信号转换成光信号
- 接下来，光信号通过光纤直接到达<u>BAS</u>前面的多路光纤收发器
- 然后，多路光纤收发器将光信号-->电信号，BAS的端口接收之后，发送进隧道
- 经过运营商的网络后，到达互联网内部
###### 使用分路
>在用户附近的电线杆上安装***分光器***让光纤分路，同时连接多个用户

部分设备与直连不同，大体过程相同
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=bzD79j7s|900]]
***用户端使用的ONU***：
- 可以将电信号转换成光信号
- 可以和电话局的OLT相互配合避免信号碰撞

终端盒 是<u>光纤收发器</u>和<u>ONU</u>等光纤终端设备的统称
### 网络包到达互联网的入口
网络包通过接入网，到达了网络运营商POP的路由器【这里是互联网的入口，网络包会从这里进入互联网内部】
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=xKf3pd00|540]]
### 网络包进入互联网
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=VMTBpvbT|520]]

>***NOC与POP：***
>NOC[^18]是运营商的核心设备，从POP[^19]传来的网络包都会集中到这里，并在这里被转发到离目的地更近的POP，或者是转发到其他的运营商。
>
>***NOC就是规模扩大后的POP***，NOC和POP没有非常严格的界定，NOC里面也可以配备连接接入网的路由器，很多情况下是和POP共用的

>[!question] POP与NOC是怎样连接的？
>由于运营商的网络中需要传输大量的包，已经超过了一般公司使用的双绞线能够容纳的极限，所以运营商一般使用***光纤***来连接POP与NOC
>
>>光纤需要在地下铺设，需要很大的工程费用，而且当线路发生中断时维护工作也需要费用。因此，只有有限的几家大型运营商才拥有光纤。而拥有光纤的公司一般都会提供光纤租用服务【通信线路服务】，其他运营商只要从拥有光纤的公司租借光纤就可以了

[^18]:网络运行中心
[^19]:“Point of Presense” 接入点
### 网络包跨运营商被转发
首先，如果最终目的地【某个Web服务器】和客户端是连接在同一个运营商中的，那么POP路由器根据路由表中的信息判断转发给<u>哪一个NOC/相邻的POP</u>，然后下一个路由器也同样 根据自己路由表中的信息继续转发。经过几次转发之后，网络包就到达了目的地所在的POP路由器，然后从这里被继续转发到某个Web服务器。

如果服务器的运营商和客户端的运营商不同，网络包需要先发到服务器所在的运营商，这些信息也可以在路由表中找到。这时网络包会被转发到对方运营商的路由器。

---

###### IX的必要性
图 4.26 中有一个叫作 IX【互联网交换中心】 的东西，我们来说说它是干什么用的。对于两个运营商来说，像图 4.26 中运营商 D 和运营商 C 这样一对一的连接是最基本的一种连接方式，现在也会使用这种方式。但这种方式有个不方便的地方，如果运营商之间只能一对一连接，那么就需要像图 4.27（a）这样将所有的运营商都用通信线路连接起来。现在光日本国内就有数千家运营商，这样连接非常困难。对于这种情况，我们可以采用图 4.27（b）的方式，设置一个中心设备，通过连接到中心设备的方式来减少线路数量，这个中心设备就称为 IX。
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=wCWZnokp]]
###### 运营商如何通过IX互相连接
为了保证在遇到停电、火灾以及自然灾害时，路由器等网络设备还能继续工作，IX所在的大楼都装有自主发电设备，并具有一定的抗震能力【其实这样的要求也不仅限于 IX，运营商的 NOC 也是一样】

IX的核心是具有大量高速以太网端口的二层交换机。

接下来就是将各个运营商的路由器连接到<u>IX核心交换机</u>上，连接方法有几种：
首先，当运营商NOC和IX位于同一幢大楼里时，只要从NOC中将光纤延长出来接到IX交换机就可以了（图 4.28 ①）。这种情况和公司、家庭网络中的路由器与交换机的连接方法是相同的。如果NOC和IX不在同一幢大楼时，我们可以用通信线路将路由器和交换机连起来。这种情况下有两种连法：
	一种是从路由器延伸出一根通信线路并连接到IX交换机上（图 4.28 ②）
	另一种是将路由器搬到IX机房里，用通信线路将路由器和NOC连起来，再将路由器连到IX交换机上（图 4.28 ③）

以前 IX 交换机都是放在一个地方的。现在在数据中心等网络流量集中的地方一般都会设置IX终端交换机，各运营商的路由器在这里连接到终端交换机上（图 4.28 ④）。
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=TySadd0e]]


IX交换机和一般的交换机在工作方式上没有区别

BAS是加强版的路由器，它有一般路由器没有的功能【身份认证，下发IP地址等配置信息】
BAS是由RAS发展而来的，一开始叫“B-RAS”，意思是用于宽带网络的RAS
RAS也是路由器，它是用一台服务器里面装上RAS软件来实现的
计算机 + 路由软件 = 路由器

#服务器端的局域网
###web服务器的部署地点
#####在公司里部署web服务器
网络包从互联网到达服务器的过程，根据服务器部署地点的不同而不同。
最简单的是图 5.1（a）中的这种情况，服务器直接部署在公司网络上，并且可以从互联网直接访问。这种情况下，网络包通过最近的POP中的路由器、接入网以及服务器端路由器之后，就直接到达了服务器。现在这已经不是主流方式了【第一个原因是IP地址不足。这样的方式需要为公司网络中的所有设备都分配各自的公有地址；另一个原因是安全问题。这种方式中，从互联网传来的网络包会无节制地进入服务器，这意味着服务器处于“裸奔”状态。当然，我们可以强化服务器本身的防御来抵挡攻击。但人工方式总会出错，安全漏洞很难完全消除，因此让服务器裸奔并不是一个稳妥的办法】。
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=gac88uKm]]
因此，现在我们一般采用图 5.1（b）中的方式，即部署防火墙。防火墙只允许发往指定服务器的指定应用程序的网络包通过。这样一来，即便应用程序存在安全漏洞，也可以降低相应的风险。因为防火墙屏蔽了不允许从外部访问的应用程序，所以即便这些程序存在安全漏洞，用于攻击的网络包也进不来。当然，即便如此风险也不会降到零，因为如果允许外部访问的应用程序中有
安全漏洞，还是有可能遭到攻击的。
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=yqIc6sgY]]

防火墙：一种抵御外部网络攻击的机制，也是最早出现的一种防御机制。现在已经出现了很多可以绕过防火墙的攻击方法，因此防火墙一般需要和反病毒、非法入侵检测、访问隔离等机制并用。

#####将Web服务器部署在数据中心
Web服务器也可以像图 5.1（c）这样把服务器放在网络运营商等管理的数据中心里，或者直接租用运营商提供的服务器。
数据中心是与运营商核心部分 NOC 直接连接的，或者是与运营商之间的枢纽 IX 直接连接的。换句话说，数据中心通过高速线路直接连接到互联网的核心部分，因此将服务器部署在这里可以获得很高的访问速度，当服务器访问量很大时这是非常有效的。此外，数据中心一般位于具有抗
震结构的大楼内，还具有自主发电设备，并实行 24 小时门禁管理，具有更高的安全性。此外，数据中心不但提供安放服务器的场地，还提供各种附加服务【如服务器工作状态监控、防火墙的配置和运营、非法入侵监控等】。
如果 Web 服务器部署在数据中心里，那么网络包会从互联网核心部分直接进入数据中心，然后到达服务器。如果数据中心有防火墙，则网络包会先接受防火墙的检查，放行之后再到达服务器。

###防火墙的结构和原理
#####主流的包过滤方式
防火墙的基本思路是只允许发往特定服务器中的特定应用程序的包通过，然后屏蔽其他的包。不过，特定服务器上的特定应用程序这个规则看起来不复杂，但网络中流动着很多各种各样的包，如何才能从这些包中分辨出哪些可以通过，哪些不能通过呢？为此，人们设计了多种方式 【防火墙可分为包过滤、应用层网关、电路层网关等几种方式。】，其中任何一种方式都可以实现防火墙的目的，但出于性能、价格、易用性等因素，现在最为普及的是包过滤方式。

#####如何设置包过滤的规则
假设我们的网络如图 5.2 所示，将开放给外网的服务器和公司内网分开部署，Web服务器所在的网络可以从外网直接访问。现在我们希望允许从互联网访问 Web 服务器（图 5.2 ①），但禁止 Web 服务器访问互联网（图 5.2 ②）。【以前很少禁止 Web 服务器访问互联网，但现在出现了一些寄生在服务器中感染其他服务器的恶意软件，如果阻止 Web 服务器访问互联网，就可以防止其他服务器被感染】
要实现这样的要求，应该如何设置包过滤的规则呢？
在设置包过滤规则时，首先要观察包是如何流动的。在图5.2 ①的例子中，包从互联网流向Web服务器，从互联网发送过来的包其起点是不确定的，但终点是确定的。因此，我们可以按此来设定规则，允许符合规则的包通过。也就是说，允许起点（发送方 IP 地址）为任意，终点（接收方 IP 地址）为 Web 服务器 IP 地址的包通过（图 5.2 中表的第 1行）。
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=0pE3Dhoi]]

这样一来，从互联网发往 Web 服务器的包就可以通过防火墙了，但光这样还无法完成访问。因为收到包之后，Web 服务器需要通过确认应答机制通知发送方数据已经正常收到，这需要 Web 服务器向互联网发送包。在 Web 服务器发往互联网的包中，我们可以将起点为Web服务器地址的包设置为允许通过（图 5.2 中表的第 3 行）。

#####通过端口号限定应用程序
不过，按照前面的设置，相当于允许了互联网和 Web 服务器之间所有 的包通过，这个状态很危险。假如服务器上还有一个文件服务器程序在工 作，那么这些文件就可能会被非法访问从而造成信息泄露。因此，我们最好是阻止除必需服务以外的所有应用程序的包。
当我们要限定某个应用程序时，可以在判断条件中加上 TCP 头部或者 UDP 头部中的端口号。Web 服务器的端口号为 80，因此我们在刚才的接 收方 IP 地址和发送方 IP 地址的基础上再加上 80 端口作为条件就可以了。 

#####通过控制位判断连接方向
现在我们已经可以指定某个具体的应用程序了，但是还没有办法阻止 Web 服务器访问互联网。Web 使用的 TCP 协议是双 向收发网络包的，因此如果单纯地阻止从 Web 服务器发往互联网的包，则 从互联网访问 Web 服务器的操作也会受到影响而无法进行。光判断包的流向还不够，我们必须要根据访问的方向来进行判断。这里就需要用到 TCP 头部中的控制位。TCP 在执行连接操作时需要收发 3 个包，其中第一个包的 TCP 控制位中 SYN 为 1，而 ACK 为 0（其他的包中这些值都不同），因 此只要按照这个规则就能够过滤到 TCP连接的第一个包。
如果这第一个包是从 Web 服务器发往互联网的，那么我们就阻止它 (图 5.2 表中的第 2 行)。这样设置之后，TCP 连接操作就失败了。也就是说，只要以 Web 服务器为起点 访问互联网，其连接操作必然会失败，这样一来，我们就阻止了 Web 服务器对互联网的访问。
从互联网访问 Web服务器时，第一个包是接收方为 Web 服务器，符合图 5.2 表中的第 1 行， 因此允许通过。第二个包的发送方是Web 服务器，但 TCP 控制位的规则与第二行不匹配（第二个包中，SYN 为 1，ACK 也为 1），因此符合第三行的规则，允许通过。随后的所有包要么 符合第一行，要么符合第三行，因此从互联网访问Web服务器的所有包都会被允许通过。

通过接收方 IP 地址、发送方 IP 地址、接收方端口号、发送方端口号、 TCP 控制位这些条件，我们可以判断出通信的起点和终点、应用程序种 类，以及访问的方向。

不过，实际上也存在无法将希望允许和阻止的访问完全区分开的情况， 其中一个代表性的例子就是对 DNS 服务器的访问。DNS 查询使用的是 UDP 协议，而 UDP 与 TCP 不同，它没有连接操作，因此无法像 TCP 一样 根据控制位来判断访问方向。所以，我们无法设置一个规则，只允许公司内部访问互联网上的 DNS 服务器，而阻止从互联网访问公司内部的 DNS
服务器。这一性质不仅适用于 DNS，对于所有使用 UDP 协议的应用程序都是共通的。

#####从公司内网访问公开区域的规则
我们还需要设置公司内网和互联网之间，或者公司内网与公开区 域之间的包过滤规则。例 如，为了让公司内网与公开区域之间的网络包自由流动，我们可以将接收 方 IP 地址为公开区域的包设置成全部允许通过。但是，如果在这条规则里 没有限定发送方 IP 地址，那么连来自互联网的包也都会被无条件允许进入 公开区域了，这会导致公开区域中的服务器全部暴露在危险状态中。

#####从外部无法访问公司内网
包过滤方式的防火墙不仅可以允许或者阻止网络包的通过，还具备地 址转换功能。也就是说，互联网和公司内网 之间的包需要进行地址转换才能传输。具体来说，就是和包过滤一样，以起点和终点作为条件，根据需要设置是否需要进行地址转换。私有地址和公有地址之间的对应关系，以及端口号的对应关系都是自动管理的，因此只需要设置是否允许地址转换就可以了。
当使用地址转换时，默认状态下是无法从互联网访问公司内网的（表中还没有对应的记录），因此我们不需要再设置一条包过滤规 则来阻止从互联网访问公司内网。

#####通过防火墙
如果防火墙阻止包通过，那么这个包会被丢弃并被记录下来（如果将内置包过滤功能的路由器用作防火墙，则在丢弃包时基本上不会留 下记录，这是因为路由器的内存容量小，没有足够的空间用来记录日志）。这是因为 这些被丢弃的包中通常含有非法入侵的痕迹，通过分析这些包能够搞清楚 入侵者使用的手法，从而帮助我们更好地防范非法入侵。

如果包被判断为允许通过，则该包会被转发出去。

实际上，在防火墙允许包通过之后，就没有什么特别的机制了，因此 包过滤并不是防火墙专用的一种特殊机制，而是应该看作在路由器的包转 发功能基础上附加的一种功能。只不过当判断规则比较复杂时，通过路由 器的命令难以维护这些规则，而且对阻止的包进行记录对于路由器来说负 担也比较大，因此才出现了专用的硬件和软件。如果规则不复杂，也不需 要记录日志，那么用内置包过滤功能的普通路由器来充当防火墙也是可 以的。

#####防火墙无法抵御的攻击
防火墙可以根据包的起点和终点来判断是否允许其通过，但仅凭起 点和终点并不能筛选出所有有风险的包。比如，假设 Web 服务器在收到 含有特定数据的包时会引起死机。但是防火墙不关心包中的数据，防火墙也无法发现，于是包就被放行了。 然后，当包到达 Web 服务器时，就会引发服务器死机。

要应对这种情况有两种方法。这个问题的根源在于 Web 服务器程序的 Bug，因此修复 Bug 防止死机就是其中一种方法。

另一种方法就是在防火墙之外部署用来检查包的内容并阻止有害包的设备或软件。当然，即便是采用这种方法也并不是完美无缺的，因为包的 内容是否有风险，是由 Web 服务器有没有 Bug 决定的，因此当服务器程序 中有潜在的 Bug 并且尚未被发现时，我们也无法判断包中的风险。也就是说，我们无法抵御未知的风险。

从这一点来看，这 种方法和直接修复 Bug 的方法是基本等效的，但如果服务器数量较多，更 新软件版本需要花费一定的时间，或者容易忘记更新软件，这时对包的内 容进行检查就会比较有效。

###通过将请求平均分配给多台服务器来平衡负载
#####性能不足时需要负载均衡


# 防火墙，缓存服务器
防火墙不会检查通信数据的具体内容，因此无法抵御隐藏在通信数据内容中的攻击

# Web服务器
##### 收到响应
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=Abd79e9Y|600]]
###### 状态码
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=XPJza8ki|600]]
- `200` OK：请求已正常处理，返回所需内容
- 201 Created：请求已成功处理，并创建了新的资源
- 204 No Content：请求已成功处理，但没有返回内容
- 301 Moved Permanently：请求的资源已永久移动到新位置。
- `302` Found：请求的资源已临时移动到新位置
- `304` Not Modified：客户端缓存的资源仍然有效，无需返回内容
- `400` Bad Request：客户端请求有语法错误，服务器不能理解
- 401 Unauthorized：未授权访问资源。
- `403` Forbidden：禁止访问资源，客户端没有权限
- `404` Not Found：请求的资源不存在
- `405` Method Not Allowed：请求方式有误
- `429` Too Many Requests：表示客户端发送的请求过多，在给定的时间内超出了服务器的限制
- `500` Internal Server Error：服务器内部错误，无法完成请求
- `503` Service Unavailable：服务器当前无法处理请求【过载/正在维护/正在初始化】
##### 一些操作
##### 接收数据
- 协议栈会检查收到的数据块和TCP头部内容，如果没问题则返回ACK号
- 将数据暂存到接收缓冲区，并按顺序还原出原始数据
- 协议栈尝试从缓冲区中取出数据并传递给应用程序
