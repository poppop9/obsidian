# 网络的全貌
浏览器和Web服务器之间的交互却很简单，概括如下：
(1)浏览器向Web服务器发送请求；
(2)Web服务器根据请求向浏览器发送响应；

要实现应用程序之间的交互，我们需要一个能够在浏览器和Web服务器之间传递请求和响应的机制。网络是由很多计算机等设备相互连接组成的，因此在通信的过程中需要确定正确的通信对象，并将请求和响应发送给它们。请求和响应在传递的过程中可能会丢失或损坏【请求和响应本质都是电信号和光信号，这些信号可能会因收到杂音等干扰而损坏】。所以需要一种机制，无论遇到任何情况都能够将请求和响应准确无误地发送给对方。
这种机制是由操作系统中的网络控制软件，以及交换机、路由器等设备分工合作来实现的，它的基本思路是将数字信息分割成一个一个的小块，然后装入一些被称为“包”(Packet)的容器中来运送。大家可以这样理解：包相当于信件或者包裹，而交换机和路由器则相当于邮局或快递公司的分拣处理区。包的头部存有目的地等控制信息，通过许多交换机和路由器的接力，就可以根据控制信息对这些包进行分拣，然后将它们一步一步地搬运到目的地。
无论是家庭和公司里的局域网，还是外面的互联网，它们只是在规模上有所不同，基本的机制都是相同的。

前面介绍的这个负责搬运数字信息的机制，再加上浏览器和Web服务器这些网络应用程序，这两部分就组成了网络。

# URL
>[!quote] URL
>URL 就是形如“http://”、“ftp://”、“file://”、“mailto://”等开头的链接，URL 的开头就是告诉浏览器使用哪种功能来访问相应的数据

`http://user:password@www.glasscom.com:80/dir/file1.htm`  会包含服务器的域名，文件的路径
`ftp://user:password@ftp.glasscom.com:21/dir/file1.htm`
`file://localhost/c:/path/file1.zip`
`mailto:tone@glasscom.com`  会包含收件人的邮件地址

>[!hint] URL 省略文件名
>在大多数的 Web 服务器中，当你访问一个目录而不是具体的文件时，服务器会自动寻找并返回那个目录下的默认文件
> - `http://www.lab.glasscom.com/dir/` 这种时候服务器就会访问 `/dir/index.html` ，或 `/dir/default.htm`
> - `http://www.lab.glasscom.com/` 这时会访问服务器根目录下的 `index.html` ，或者 `default.htm` 文件

>[!hint] URL 的层次结构
>>通过 `.` 来分割层级，**越靠右的层级越高**
>
> ```
> 例如 www.nikkeibp.co.jp
> jp 代表分配给日本这个国家的域，这个域的下一级又有很多域，co 就是其中之一；
> co 代表公司的域，公司有很多公司，nikkeibp 就是其中之一；
> nikkeibp 代表分配给这家公司的域
> ```

# TCP / IP
>[!quote] TCP / IP
>TCP / IP 就是由一些小的子网【由集线器连接起来的几台计算机】，通过路由器连接起来组成一个大的网络
>![500](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202404141253331.png)
>发送者发出的消息首先经过子网中的<u>集线器A</u>，转发到距离发送者最近的<u>路由器A</u>上，接着这个<u>路由器A</u>会根据目的地的位置判断要传送的下一个<u>路由器B</u>【传送到下一个子网的<u>集线器B</u>，再到<u>路由器B</u>】……直到到达目的地

## 唯一标识
### IP 地址
>[!quote] IP 地址
>IP 地址 是在同一网络下可以唯一标识的标识号，由**网络号**+**主机号**组成【例如`10.11.12.13`】

>[!quote] IPv4
>用 32 个 bit 以 <u>点分十进制表示法</u> 表示
> ```
> 例如：11000000 10101000 00000001 0100010
> 表示成 192.168.1.66
> ```

>[!quote] IPv6

>[!faq] 如何解决 IP 地址不足的问题 ？
>将公司内网分成：
>- **对互联网开放的服务器**【配公有地址】
>- **公司内部设备**【配私有地址】
>
>现在即使 A 公司的某台服务器和 B 公司的某台客户端具有相同的 IP 地址也没关系

由于网络号和主机号的具体结构是不固定的，所以我们要引入**子网掩码**来区分

### 子网掩码
>[!quote] 子网掩码
>子网掩码 表示网络号与主机号之间的边界

表示方式：
- 十进制加分隔号 `10.11.12.13/255.255.255.0`
- 网络号比特数 `10.11.12.13/24`

### MAC 地址
>[!hint] MAC 地址的结构
>MAC 地址长 48 bit，有两种写法：
>- `00-80-C8-2D-82-EA`
>- `00:80:C8:2D:82:EA`

>[!hint] 如何知道目标的 MAC 地址 ？
> - **通过 ARP 协议查询目标路由器的MAC地址**：在以太网中，会通过广播把包发给连接在以太网中的所有设备。ARP 会向所有设备提问“这个 IP 地址是谁的？请把你的 MAC 地址告诉我”，如果对方存在则会回应；如果路由表设置不正确，则只能认为对方不存在，包的发送就会失败

### 端口号
>[!quote] 端口号
>端口号 是唯一能标识一台计算机上的应用程序的标识号

>[!hint] 端口号的表示
>端口号由两个字节表示的整数组成，所以取值范围是 `0 - 65536`【其中 `0 - 1023` 用于一些知名的网络服务和应用】

## DNS 服务器
>[!quote] DNS
>DNS 是域名服务系统，将 IP 地址与域名进行关联

>[!hint] 缓存机制
>>每次查询 IP 地址都要从根域服务器开始那就效率太低了，所以 DNS 服务器里会有缓存，**可以记住之前查询过的域名**，下次查询可以快速响应
>
>- **缓存信息是有有效期的**：由于原本的域名注册信息会改变，这就会导致缓存里的注册信息是错误的

>[!hint] 一台 DNS 只能存储一个，或多个完整的域
>>比如 `.com` 域底下分了多个层级，例如 `.example` ，`.google` ……，那么一台 DNS 服务器只能完整的存储 `.example` 这个域【不能这台存一点 `.example` ，另一台又存一点 `.example`】
>
>当然全世界也可以只用一台 DNS 把 `.com` 这个域全部存了，但是太多了，所以我们分层存

## TCP 协议
![450](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202404141329659.png)

---

### 如何建立管道和销毁管道
>[!quote] 套接字
>套接字 就是管道两端的数据出入口

- 首先服务器先创建**套接字**，之后等待客户端连接管道；之后客户端也创建套接字，然后从该套接字延伸管道，连接到服务器端的套接字上
- 当数据传送完毕之后，断开管道可以由任何一方发起，之后套接字随之销毁

>[!question] TCP 是如何确定对方是否收到信息的 ？
>![800](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202404141333005.png)

---

### TCP / IP 包
>[!quote] TCP / IP 包
>![500](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202404141336068.png)
>- **IP 头部**：包含自己网卡的 IP 地址，目的地的 IP 地址，协议号【包的内容类型】……
>- **MAC 头部**：包含发送方和接收方的 MAC 地址，以太类型【IP 协议，ARP 协议，IPv6 协议】

>[!question] 包是如何传输的？
>![600](https://obsidian-1307744200.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87/202404141337894.png)
>1. 网络包中有下一个路由器R1的MAC地址，有目的地服务器S的IP地址；
>2. 首先网络包会经过集线器，集线器通过包中的MAC头部信息，查找以太网表知道这个包该发往哪个路由器；
>3. 传输到<u>路由器R1</u>后根据IP表，知道要发往的下一个路由器的位置，但是为了发过去我们还需要查出下一个<u>路由器R2</u>的MAC地址，然后改写MAC头部；
>4. …………；
>5. 直到送达目的地；

## UDP 协议
UDP 协议只负责发送包，出错时就收不到对方的回复，应用程序会注意到这个问题，会重新发送一遍数据

### 什么情况下使用UDP协议
- 数据很短，用一个包就能装得下的情况下【因为只有一个包，就不用考虑哪个包未送达了，就算重发也就是重发一个包】。***例如DNS查询***
- 重发数据也没什么意义时。***例如发送音频和视频数据时***【因为音频和视频必须在短时间内送达，不然会引起卡顿掉帧，而TCP协议繁琐的传输流程不合适，而且音频和视频缺少某些包一般可以接受】

==当需要穿越防火墙传输音频和视频数据时，我们有时会使用TCP协议【因为 UDP 经常会被防火墙阻止】==

## 以太网
>[!quote] 以太网
>以太网 是一种为多台计算机能够彼此自由和廉价地互相通信而设计的通信技术

**IP 协议本身没有传输包的功能，包的实际传输要委托以太网来完成**

### 以太网的进化历史
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=qaHryAp7]]
>- (a)
>	***当一台计算机发送信号时，信号会通过网线流过整个网络，最终到达所有的设备***
>	收发器：将不同网线之间的信号连接起来
>
>- (b)
> 后来(a)变成了(b)，(b)的信号依旧会发送给所有设备，但是将主干网线-->中继式集线器【集线器】，将收发器网线-->双绞线
> 
>- (c)
>   交换式集线器被称为***交换机***

### 以太网的特点
- 自动协商：确定最优的传输速率
>当两台设备通电并完成硬件初始化之后，就会开始用脉冲信号发送自己支持的速率【木桶效应】和工作模式【全/半双工】

## 局域网LAN
![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=bCkH68Rs]]

## 设备
### 网卡
>[!quote] 网卡
>网卡 可能是<u>计算机主板上的板卡</u>，<u>笔记本上的PCMCIA卡</u>，或者是<u>计算机主板上集成的芯片</u>

- 内部结构
>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=KlPCtkvx|600]]

### 集线器

>[!quote] 集线器
>集线器 就是按照以太网规则传输包的设备，集线器可以在子网中将网络包传输到下一个路由器

现在我们基本不使用集线器了，而是直接将计算机连接到交换机上

### 交换机
>[!quote] 交换机
>交换机 = 计算机 + 多块网卡 + 开启“混杂模式”【让网卡接收所有的包】+ 安装网络包转发软件

- 交换机中的MAC表是如何维护的 ？
>- 当<u>发送方</u>向交换机发送包时，交换机会记录发送方的MAC地址和包进入交换机时的端口号。【***以便以后要向该发送方发送包时，交换机可以快速反应***】
>- MAC表会在一段时间删除一些记录【防止终端设备移动产生问题】

>[!question] 网卡与交换机的区别
>- ***网卡本身具有MAC地址***，***而交换机的端口不具有MAC地址***
>- ***网卡会根据MAC地址核对包是不是发给自己的***，***而交换机则接收所有的包并存放到缓冲区***

>[!question] 集线器与交换机的区别
>- ***交换机具有更好的性能和碰撞管理能力***
>- ***交换机会根据MAC地址将包发送到正确的端口，而不是广播。从而减少了碰撞的可能性***
>- 交换机的端口速度和带宽远高于集线器

### 路由器
>[!quote] 路由器
>路由器 就是按照 IP 规则传输包的设备，路由器可以根据目标地址判断下一个路由器的位置

>[!hint] 早期路由器 = 计算机 + 路由软件

- 路由器的内部结构
> ![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=c8bABV8y|600]]
> ***转发模块***：负责判断包的转发目的地，类似于==IP模块==
> ***端口模块***：负责包的收发操作，类似于==网卡==

>[!quote] 公有地址
>原来的固定地址，可以和互联网直接通信

>[!quote] 私有地址
>私有地址 是在互联网上未被注册的 IP 地址，用于组织内部的网络，<u>不能直接用于互联网通信</u>。当需要与互联网上的设备通信时，需要通过网络地址转换技术【NAT】将私有地址转换为公有地址
>
>>私有地址的范围：
>>`10.0.0.0 ~ 10.255.255.255`
>>`172.16.0.0 ~ 172.31.255.255`
>>`192.168.0.0 ~ 192.168.255.255`

- 路由器的功能
	- *地址转换*：在转发网络包时对 <u>IP 头部</u> 中的 IP地址 和 端口号[^2] 进行改写
		>假设现在要访问 Web 服务器：
		>- 首先，TCP 连接操作的**第一个包**被转发到互联网时，会将发送方 IP 地址从私有地址改写成公有地址[^3]
		>- 接着，地址转换设备会随机生成一个空闲端口，并改写前私有地址的端口号
		>- 最后，将改写前和改写后的 地址 和 端口号 作为一组对应的记录保存在地址转换设备内部的表中
		>![[Excalidraw/计算机/四大件/计算机网络 Draw.md#^group=OyGYltBf|500]]
	- 包过滤[^4]：在队报进行转发时，根据MAC头部，IP头部，TCP头部的内容，按照事先设置好的规则决定是 转发/丢弃 这个包

[^2]:指的是TCP和UDP的端口号，不是路由器和集线器连接网线的那个端口
[^3]:此处为地址转换设备的互联网接入端口的地址
[^4]:大多数防火墙设备/软件都是利用这一机制来防止非法入侵的

我们的家用路由器已经集成了<u>集线器</u>，<u>交换机</u>的功能

>[!question] 交换机与路由器的区别
>**交换机是基于 以太网 设计的**
>**路由器是基于 IP 设计的**，路由器的每个端口都有<u>MAC地址</u>和<u>IP地址</u>
>==路由器委托交换机传输包